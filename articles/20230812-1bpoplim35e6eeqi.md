---
title: 'View Transitions API ã¨ Navigation API ã‚’ç”¨ã„ã¦éåŒæœŸé·ç§»ã‚¢ãƒ‹ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹'
emoji: 'ğŸ“š'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['HTML', 'CSS', 'JavaScript']
published: false
---

Chrome 102 ä»¥é™ã§ **Navigation API** ãŒã€Chrome 111 ä»¥é™ã§ **View Transitions API** ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚ æœ¬è¨˜äº‹ã§ã¯ã€ã“ã®äºŒã¤ã® API ã‚’ç”¨ã„ãŸéåŒæœŸé·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

:::message
ã“ã®è¨˜äº‹ãŒåŸ·ç­†ã•ã‚ŒãŸ 2023 å¹´ 8 æœˆ 12 æ—¥ç¾åœ¨ã§ã¯ã€View Transitions API ã¨ Navigation API ã¯ã¾ã é™ã‚‰ã‚ŒãŸãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ç¯„å›²ã§ã—ã‹ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã¯ã€ã€Œ[Can I use... Support tables for HTML5, CSS3, etc](https://caniuse.com/)ã€ã¨ã„ã£ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚
:::
https://caniuse.com/mdn-api_navigation
https://caniuse.com/view-transitions

## ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆ&ã‚³ãƒ¼ãƒ‰

https://vta-and-na.yend.dev/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo

æœ¬è¨˜äº‹ã§ã¯ä¸Šè¨˜ã®ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã¨ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«èª¬æ˜ã‚’è¡Œã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å…¨ä½“çš„ãªæŒ™å‹•ã‚„ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸã„éš›ã¯ã€ä¸Šè¨˜ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

## View Transitions API

View Transitions API ã‚’ç”¨ã„ã‚‹ã¨ã€ç•°ãªã‚‹ DOM çŠ¶æ…‹é–“ã§ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç°¡å˜ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

https://vta-and-na.yend.dev/view-transitions-api/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/view-transitions-api

### View Transitions API ã‚’ç”¨ã„ãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

```js
const swap = async ([to, from]) => {
  return document.startViewTransition(() => {
    from.hidden = true;
    to.hidden = false;
  }).updateCallbackDone;
};

const findAnchorElement = element => {
  if (element.tagName === 'A') {
    return element;
  }
  return null;
};
const findParentAnchorElement = element => {
  return element.closest('a');
};

const bookIndexPage = document.querySelector(
  '*[data-transition-wrapper="book-index"]'
);
const bookDetailPage = document.querySelector(
  '*[data-transition-wrapper="book-detail"]'
);
const pageList = [bookIndexPage, bookDetailPage];

const documentBody = document.body;
documentBody.addEventListener('click', async e => {
  const target = e.target;
  const anchorElement =
    findAnchorElement(target) || findParentAnchorElement(target);
  if (anchorElement) {
    e.preventDefault();
    const url = new URL(anchorElement.href);
    const params = url.searchParams;
    const nextPage = params.get('page') ?? 'book-index';
    const nextSwapList =
      nextPage === 'book-index' ? pageList : [...pageList].reverse();
    await swap(nextSwapList);
  }
});
```

## Navigation API

Navigation API ã¯ã€ãƒšãƒ¼ã‚¸é·ç§»ã‚„ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã® API ã§ã™ã€‚

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

https://vta-and-na.yend.dev/navigation-api/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/navigation-api

### Navigation API ã‚’ç”¨ã„ãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```js
const parser = new DOMParser();
const parseHTML = html => {
  return parser.parseFromString(html, 'text/html');
};
const getHTML = async url => {
  return fetch(url).then(res => res.text());
};
const swap = (from, to) => {
  from.replaceWith(to);
};

const shouldNotIntercept = navigationEvent => {
  // å‚è€ƒ: https://developer.chrome.com/docs/web-platform/navigation-api/#deciding-how-to-handle-a-navigation
  return (
    !navigationEvent.canIntercept ||
    navigationEvent.hashChange ||
    navigationEvent.downloadRequest ||
    navigationEvent.formData
  );
};
navigation.addEventListener('navigate', e => {
  if (shouldNotIntercept(e)) return;

  const loadNextPage = async () => {
    const htmlString = await getHTML(e.destination.url);
    const parsedHTML = parseHTML(htmlString);
    const toHTML = parsedHTML.querySelector('*[data-transition-wrapper]');
    const fromHTML = document.querySelector('*[data-transition-wrapper]');
    swap(fromHTML, toHTML);
    document.title = parsedHTML.title;
  };
  e.intercept({ handler: loadNextPage });
});
navigation.addEventListener('navigatesuccess', e => {
  console.log(e);
});
navigation.addEventListener('navigateerror', e => {
  console.error(e);
});
```

## View Transitions API ã¨ Navigation API ã‚’ç”¨ã„ãŸéåŒæœŸé·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…

ãã‚Œã§ã¯ã€View Transitions API ã¨ Navigation API ã‚’çµ„ã¿åˆã‚ã›ã¦éåŒæœŸé·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

https://vta-and-na.yend.dev/async-transition-animation/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/async-transition-animation

```js
const parser = new DOMParser();
const parseHTML = html => {
  return parser.parseFromString(html, 'text/html');
};
const getHTML = async url => {
  return fetch(url).then(res => res.text());
};
const swap = ([from, to]) => {
  return document.startViewTransition(() => {
    from.replaceWith(to);
  }).updateCallbackDone;
};

const shouldNotIntercept = navigationEvent => {
  // å‚è€ƒ: https://developer.chrome.com/docs/web-platform/navigation-api/#deciding-how-to-handle-a-navigation
  return (
    !navigationEvent.canIntercept ||
    navigationEvent.hashChange ||
    navigationEvent.downloadRequest ||
    navigationEvent.formData
  );
};
navigation.addEventListener('navigate', e => {
  if (shouldNotIntercept(e)) return;

  const loadNextPage = async () => {
    const htmlString = await getHTML(e.destination.url);
    const parsedHTML = parseHTML(htmlString);
    const toHTML = parsedHTML.querySelector('*[data-transition-wrapper]');
    const fromHTML = document.querySelector('*[data-transition-wrapper]');
    await swap([fromHTML, toHTML]);
    document.title = parsedHTML.title;
  };
  e.intercept({ handler: loadNextPage });
});
navigation.addEventListener('navigatesuccess', e => {
  console.log(e);
});
navigation.addEventListener('navigateerror', e => {
  console.error(e);
});
```

## çµ‚ã‚ã‚Šã«

ã“ã®è¨˜äº‹ã§ã¯ã€View Transitions API ã¨ Navigation API ã‚’æ´»ç”¨ã—ãŸéåŒæœŸé·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬çš„ãªå®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
å®Ÿã¯ [Cross Document View Transitions](https://github.com/WICG/view-transitions/blob/main/cross-doc-explainer.md) ãªã‚‹ã‚‚ã®ã‚‚ç­–å®šä¸­ï¼Ÿã‚‰ã—ã„ã®ã§ã€å°†æ¥çš„ã«ã¯æœ¬è¨˜äº‹ã§ç´¹ä»‹ã—ãŸæ–¹æ³•ã‚ˆã‚Šã‚‚ã€ã•ã‚‰ã«ç°¡æ˜“ãªæ–¹æ³•ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãéåŒæœŸé·ç§»ãŒå®Ÿç¾ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚å¼•ãç¶šãã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚


## å‚è€ƒ

https://drafts.csswg.org/css-view-transitions/
https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API
https://ics.media/entry/230510/
https://html.spec.whatwg.org/multipage/nav-history-apis.html#navigation-api
https://developer.mozilla.org/en-US/docs/Web/API/Navigation_API
https://blog.jxck.io/entries/2022-04-22/navigation-api.html
