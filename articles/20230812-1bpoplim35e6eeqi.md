---
title: 'View Transitions API ã¨ Navigation API ã§ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ã—ã¦ã¿ã‚‹'
emoji: 'ğŸ“š'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['HTML', 'CSS', 'JavaScript']
published: false
---

Chrome 102 ä»¥é™ã§ **Navigation API** ãŒã€Chrome 111 ä»¥é™ã§ **View Transitions API** ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚ æœ¬è¨˜äº‹ã§ã¯ã€ã“ã®äºŒã¤ã® API ã‚’ç”¨ã„ãŸãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

:::message
ã“ã®è¨˜äº‹ãŒåŸ·ç­†ã•ã‚ŒãŸ 2023 å¹´ 8 æœˆ 12 æ—¥ç¾åœ¨ã§ã¯ã€View Transitions API ã¨ Navigation API ã¯ã¾ã é™ã‚‰ã‚ŒãŸãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ç¯„å›²ã§ã—ã‹ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã¯ã€ã€Œ[Can I use... Support tables for HTML5, CSS3, etc](https://caniuse.com/)ã€ã¨ã„ã£ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚
:::
https://caniuse.com/mdn-api_navigation
https://caniuse.com/view-transitions

## ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆ&ã‚³ãƒ¼ãƒ‰

https://vta-and-na.yend.dev/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo

æœ¬è¨˜äº‹ã§ã¯ä¸Šè¨˜ã®ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã¨ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«èª¬æ˜ã‚’è¡Œã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å…¨ä½“çš„ãªæŒ™å‹•ã‚„ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸã„éš›ã¯ã€ä¸Šè¨˜ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

## View Transitions API

View Transitions API ã¯ã€ç•°ãªã‚‹ DOM çŠ¶æ…‹é–“ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ç”»é¢é·ç§»ã‚’ä½œæˆã—ã€DOM å†…å®¹ã‚’ä¸€åº¦ã«æ›´æ–°ã™ã‚‹æ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚

ãƒ“ãƒ¥ãƒ¼é·ç§»ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è² æ‹…ã‚’è»½æ¸›ã—ã€ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ç§»å‹•ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«ã™ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³æ‰‹æ³•ã§ã™ã€‚ã—ã‹ã—ã€ç•°ãªã‚‹ DOM çŠ¶æ…‹é–“ã«ãŠã‘ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ç”»é¢é·ç§»ã¯ã€å¾“æ¥ã®æ–¹æ³•ã§ã¯å®Ÿè£…ãŒé›£ã—ãè¤‡é›‘ã§ã—ãŸã€‚View Transitions API ã¯ã“ã‚Œã‚‰ã®èª²é¡Œã‚’ç°¡æ½”ãªæ–¹æ³•ã§è§£æ±ºã—ã¾ã™ã€‚

View Transitions API ã®è©³ç´°ãªèª¬æ˜ã«ã¤ã„ã¦ã¯ MDN ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

æœ¬è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ View Transitions API ã®å®Ÿè£…ã«ãŠã‘ã‚‹ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

https://vta-and-na.yend.dev/view-transitions-api/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/view-transitions-api

![View Transitions APIã®ãƒ‡ãƒ¢ç”»é¢](/images/20230812/view-transitions-api-demo.webp)

### View Transitions API ã‚’ç”¨ã„ãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

ã§ã¯æ—©é€Ÿã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚HTML ã®æ§‹é€ ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```html:HTML
<!-- æ›¸ç±ä¸€è¦§ç”»é¢ -->
<main class="main" data-transition-wrapper="book-index">
  <h1 class="page-title">æ›¸ç±ä¸€è¦§</h1>
  <div class="container">
    <div class="book-index-list">
      <article class="book">
        <a class="book-link link" href="/view-transitions-api/?page=book-detail">
          <img class="thumbnail" data-view-transition-name="thumbnail" src="..." />
          <h2 class="book-title" data-view-transition-name="title">å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>
          <div class="book-author">å¤ç›® æ¼±çŸ³</div>
        </a>
      </article>
    </div>
  </div>
</main>
<!--ã€€æ›¸ç±è©³ç´°ç”»é¢ï¼ˆåˆæœŸçŠ¶æ…‹ã¯hiddenã§éš ã—ã¦ã„ã‚‹ï¼‰ -->
<main class="main" data-transition-wrapper="book-detail" hidden>
  <h1 class="page-title">æ›¸ç±è©³ç´°</h1>
  <div class="container">
    <article class="book">
      <h2 class="book-title" data-view-transition-name="title">å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>
      <imgã€€class="thumbnail"ã€€data-view-transition-name="thumbnail"ã€€src="..."
      />
      <p class="book-content">å¾è¼©ã‚ãŒã¯ã„ã¯çŒ«ã§ã‚ã‚‹ã€‚åå‰ã¯ã¾ã ç„¡ã„ã€‚...</p>
      <div class="book-author">å¤ç›® æ¼±çŸ³</div>
    </article>
    <a class="link back-link" href="./">ä¸€è¦§ã¸æˆ»ã‚‹</a>
  </div>
</main>
```

ã“ã“ã§ã¯æ›¸ç±ä¸€è¦§ç”»é¢ã¨æ›¸ç±è©³ç´°ç”»é¢ã‚’ä¸€ã¤ã® HTML ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚åˆæœŸçŠ¶æ…‹ã§ã¯æ›¸ç±è©³ç´°ç”»é¢ã«`hidden`å±æ€§ã‚’ä»˜ä¸ã—ã€`display:none`ã§è¦ç´ ã®è¡¨ç¤ºã‚’æ¶ˆã—ã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ã“ã®äºŒã¤ã®ç”»é¢ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã§ã€æ“¬ä¼¼çš„ã«ãƒšãƒ¼ã‚¸é·ç§»ã‚’è¡Œãªã£ã¦ã„ã‚‹ã¨è€ƒãˆã¦ãã ã•ã„ã€‚

ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ç”»é¢é·ç§»ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ã§ã¯ã“ã®éƒ¨åˆ†ã‚’ã©ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã‹ JavaScript ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```js:JavaScript
// startViewTransition ã®å®Ÿè¡Œ
const swap = async ([to, from]) => {
  return document.startViewTransition(() => {
    from.hidden = true;
    to.hidden = false;
  }).updateCallbackDone;
};

const findAnchorElement = element => {
  if (element.tagName === 'A') {
    return element;
  }
  return null;
};
const findParentAnchorElement = element => {
  return element.closest('a');
};

// ç”»é¢è¦ç´ ã®å–å¾—
const bookIndexPage = document.querySelector(
  '*[data-transition-wrapper="book-index"]'
);
const bookDetailPage = document.querySelector(
  '*[data-transition-wrapper="book-detail"]'
);
const pageList = [bookIndexPage, bookDetailPage];

const documentBody = document.body;
documentBody.addEventListener('click', async e => {
  const target = e.target;

  // aè¦ç´ ï¼ˆãƒªãƒ³ã‚¯ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‹ã®åˆ¤åˆ¥
  const anchorElement =
    findAnchorElement(target) || findParentAnchorElement(target);

  // aè¦ç´ ã§ã‚ã‚Œã°ç”»é¢é·ç§»ã™ã‚‹
  if (anchorElement) {
    e.preventDefault();
    const url = new URL(anchorElement.href);
    const params = url.searchParams;
    const nextPage = params.get('page') ?? 'book-index';
    const nextSwapList =
      nextPage === 'book-index' ? pageList : [...pageList].reverse();
    await swap(nextSwapList);
  }
});
```

è‚ã¨ãªã‚‹ã®ã¯`swap`é–¢æ•°ã§ã™ã€‚`swap`é–¢æ•°ã®ä¸­ã§ View Transitions API ã®`document.startViewTransition()`ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```js:JavaScript
// startViewTransition ã®å®Ÿè¡Œ
const swap = async ([to, from]) => {
  return document.startViewTransition(() => {
    // DOM ã®æ›´æ–°å‡¦ç†
    // æ›¸ç±ä¸€è¦§ç”»é¢ã¨æ›¸ç±è©³ç´°ç”»é¢ã®åˆ‡ã‚Šæ›¿ãˆ
    from.hidden = true;
    to.hidden = false;
  }).updateCallbackDone;
};
```

`startViewTransition()`ã®ä¸­ã§ã¯ã€DOM ã®æ›´æ–°å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã§ã¯æ›¸ç±ä¸€è¦§ç”»é¢ã¨æ›¸ç±è©³ç´°ç”»é¢ã®åˆ‡ã‚Šæ›¿ãˆã«ãªã‚Šã¾ã™ã€‚ãªã‚“ã¨ã“ã‚Œã ã‘ã®ã‚³ãƒ¼ãƒ‰ã§ DOM ã®æ›´æ–°ã‚’ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ã•ã›ãªãŒã‚‰é·ç§»ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js:JavaScript
// aè¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«`swap()`ã‚’å®Ÿè¡Œã™ã‚‹
if (anchorElement) {
  e.preventDefault();
  const url = new URL(anchorElement.href);
  const params = url.searchParams;
  const nextPage = params.get('page') ?? 'book-index';
  const nextSwapList =
    nextPage === 'book-index' ? pageList : [...pageList].reverse();
  await swap(nextSwapList);
}
```

ã‚ã¨ã¯`a`è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«`swap()`ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚æ›¸ç±ä¸€è¦§ç”»é¢ã¨æ›¸ç±è©³ç´°ç”»é¢ã¨ã®é–“ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ç”»é¢é·ç§»ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

ã“ã“ã§ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã®æŒ™å‹•ã‚’è¦³å¯Ÿã—ã¦ã¿ã‚‹ã¨ã€ç”»é¢å…¨ä½“ã®ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ã®é·ç§»ï¼ˆ`main`è¦ç´ å…¨ä½“ã®é·ç§»ï¼‰ã¨ç•°ãªã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ã„ã‚‹è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã«æ°—ä»˜ãã¨æ€ã„ã¾ã™ã€‚
å…·ä½“çš„ã«ç”»é¢å…¨ä½“ã®é·ç§»ï¼ˆã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰ã¨ç•°ãªã‚‹å‹•ãã‚’ã—ãªãŒã‚‰é·ç§»ã—ã¦ã„ã‚‹è¦ç´ ã¯æ¬¡ã®äºŒã¤ã§ã™ã€‚ãã‚Œä»¥å¤–ã®è¦ç´ ã¯ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ã§é·ç§»ã—ã¦ã„ã¾ã™ã€‚

- ã€Œå¾è¼©ã¯çŒ«ã§ã‚ã‚‹ã€ã®æ›¸ç±ã‚¿ã‚¤ãƒˆãƒ«
- ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒ

å‰è¿°ã—ãŸäºŒã¤ã®è¦ç´ ã¯ãƒšãƒ¼ã‚¸é–“ã§ã€è¦ç´ è‡ªä½“ãŒç§»å‹•ã—ãªãŒã‚‰ç”»é¢é·ç§»ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

```html
<!-- æ›¸ç±ã‚¿ã‚¤ãƒˆãƒ« -->
<h2 class="book-title" data-view-transition-name="title">å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>

<!-- ã‚µãƒ ãƒã‚¤ãƒ« -->
<img class="thumbnail" data-view-transition-name="thumbnail" src="..." />
```

ä¸Šè¨˜ã¯å®Ÿéš›ã«è©²å½“ã™ã‚‹è¦ç´ ã®è¨˜è¿°ã§ã™ã€‚ã“ã‚Œã‚‰ã®è¦ç´ ã«å¯¾ã—ã¦å½“ãŸã£ã¦ã„ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

```css:CSS
*[data-view-transition-name] {
  contain: paint;
}
/* View Transitions API */
*[data-view-transition-name="title"] {
  view-transition-name: title;
}
*[data-view-transition-name="thumbnail"] {
  view-transition-name: thumbnail;
}
```

`view-transition-name`ã¨ã„ã†è¦‹æ…£ã‚Œãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚Šã¾ã™ã­ã€‚å®Ÿã¯ã“ã‚ŒãŒäºŒã¤ã®è¦ç´ ãŒç”»é¢å…¨ä½“ã‹ã‚‰ç‹¬ç«‹ã—ãŸç”»é¢é·ç§»ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œãªã£ã¦ã„ãŸè¦å› ã¨ãªã‚Šã¾ã™ã€‚`view-transition-name`ãŒé·ç§»å‰ã¨é·ç§»å¾Œã®ä¸¡æ–¹ã«ã‚ã‚‹å ´åˆã€ãã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒå½“ãŸã£ãŸè¦ç´ ã¯ç‹¬ç«‹ã—ãŸç”»é¢é·ç§»ã‚’è¡Œã„ã¾ã™ã€‚

### ç”»é¢é·ç§»ã®æµã‚Œ

ã“ã“ã§ãŠãŠã¾ã‹ã«ã©ã®ã‚ˆã†ãªæµã‚Œã§ç”»é¢é·ç§»ãŒè¡Œã‚ã‚Œã‚‹ã‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

::: message
å³å¯†ãªãƒ©ã‚¤ãƒ•ãƒ©ã‚µã‚¤ã‚¯ãƒ«ã«ã¤ã„ã¦ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã€‚
https://drafts.csswg.org/css-view-transitions/#lifecycle
:::

View Transitions API ã«ã‚ˆã‚‹ç”»é¢é·ç§»ã¯ã€ã–ã£ãã‚Šæ¬¡ã®æµã‚Œã«æ²¿ã£ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

1. é–‹ç™ºè€…ãŒ `document.startViewTransition(updateCallback)` ã‚’å®Ÿè¡Œã™ã‚‹
2. ã€Œå¤ã„ã€çŠ¶æ…‹ã¨ã—ã¦ã€ç¾åœ¨ã®ç”»é¢ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹
3. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒä¸€æ™‚åœæ­¢ã•ã‚‹
4. `updateCallback`ãŒå®Ÿè¡Œã•ã‚Œã‚‹
5. ã€Œæ–°ã—ã„ã€çŠ¶æ…‹ã¨ã—ã¦ã€ç¾åœ¨ã®ç”»é¢ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹
6. `view-transition` ã®æ“¬ä¼¼è¦ç´ ãŒä½œæˆã•ã‚Œã‚‹
7. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä¸€æ™‚åœæ­¢ãŒè§£é™¤ã•ã‚Œã€æ“¬ä¼¼è¦ç´ ãŒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ãªãŒã‚‰é·ç§»ã™ã‚‹
8. é·ç§»ãŒå®Œäº†ã—ãŸã‚‰ã€æ“¬ä¼¼è¦ç´ ã¯å‰Šé™¤ã•ã‚Œã‚‹

```
::view-transition
â””â”€ ::view-transition-group(root)
   â””â”€ ::view-transition-image-pair(root)
      â”œâ”€ ::view-transition-old(root)
      â””â”€ ::view-transition-new(root)
```

## Navigation API

Navigation API ã¯ã€ãƒšãƒ¼ã‚¸é·ç§»ã‚„ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã® API ã§ã™ã€‚

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

https://vta-and-na.yend.dev/navigation-api/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/navigation-api

### Navigation API ã‚’ç”¨ã„ãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```js
const parser = new DOMParser();
const parseHTML = html => {
  return parser.parseFromString(html, 'text/html');
};
const getHTML = async url => {
  return fetch(url).then(res => res.text());
};
const swap = (from, to) => {
  from.replaceWith(to);
};

const shouldNotIntercept = navigationEvent => {
  // å‚è€ƒ: https://developer.chrome.com/docs/web-platform/navigation-api/#deciding-how-to-handle-a-navigation
  return (
    !navigationEvent.canIntercept ||
    navigationEvent.hashChange ||
    navigationEvent.downloadRequest ||
    navigationEvent.formData
  );
};
navigation.addEventListener('navigate', e => {
  if (shouldNotIntercept(e)) return;

  const loadNextPage = async () => {
    const htmlString = await getHTML(e.destination.url);
    const parsedHTML = parseHTML(htmlString);
    const toHTML = parsedHTML.querySelector('*[data-transition-wrapper]');
    const fromHTML = document.querySelector('*[data-transition-wrapper]');
    swap(fromHTML, toHTML);
    document.title = parsedHTML.title;
  };
  e.intercept({ handler: loadNextPage });
});
navigation.addEventListener('navigatesuccess', e => {
  console.log(e);
});
navigation.addEventListener('navigateerror', e => {
  console.error(e);
});
```

## View Transitions API ã¨ Navigation API ã‚’ç”¨ã„ãŸéåŒæœŸé·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…

ãã‚Œã§ã¯ã€View Transitions API ã¨ Navigation API ã‚’çµ„ã¿åˆã‚ã›ã¦éåŒæœŸé·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

https://vta-and-na.yend.dev/async-transition-animation/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/async-transition-animation

```js
const parser = new DOMParser();
const parseHTML = html => {
  return parser.parseFromString(html, 'text/html');
};
const getHTML = async url => {
  return fetch(url).then(res => res.text());
};
const swap = ([from, to]) => {
  return document.startViewTransition(() => {
    from.replaceWith(to);
  }).updateCallbackDone;
};

const shouldNotIntercept = navigationEvent => {
  // å‚è€ƒ: https://developer.chrome.com/docs/web-platform/navigation-api/#deciding-how-to-handle-a-navigation
  return (
    !navigationEvent.canIntercept ||
    navigationEvent.hashChange ||
    navigationEvent.downloadRequest ||
    navigationEvent.formData
  );
};
navigation.addEventListener('navigate', e => {
  if (shouldNotIntercept(e)) return;

  const loadNextPage = async () => {
    const htmlString = await getHTML(e.destination.url);
    const parsedHTML = parseHTML(htmlString);
    const toHTML = parsedHTML.querySelector('*[data-transition-wrapper]');
    const fromHTML = document.querySelector('*[data-transition-wrapper]');
    await swap([fromHTML, toHTML]);
    document.title = parsedHTML.title;
  };
  e.intercept({ handler: loadNextPage });
});
navigation.addEventListener('navigatesuccess', e => {
  console.log(e);
});
navigation.addEventListener('navigateerror', e => {
  console.error(e);
});
```

## Cross Document View Transitions

ã•ã¦ã“ã“ã§ã‚‚ã†ä¸€æ­©é€²ã‚“ã  [Cross Document View Transitions](https://github.com/WICG/view-transitions/blob/main/cross-doc-explainer.md) ã«ã‚‚è§¦ã‚Œã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

:::message
Cross Document View Transitions ã¯ã€ç¾åœ¨ Google Chrome ã«ãŠã„ã¦ [chrome://flags/#view-transition-on-navigation](chrome://flags/#view-transition-on-navigation) ã‚’ Enabled ã«ã™ã‚‹ã“ã¨ã§ä½¿ç”¨ã§ãã¾ã™ã€‚
:::

## çµ‚ã‚ã‚Šã«

ã“ã®è¨˜äº‹ã§ã¯ã€View Transitions API ã¨ Navigation API ã‚’æ´»ç”¨ã—ãŸéåŒæœŸé·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬çš„ãªå®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚

## å‚è€ƒ

https://drafts.csswg.org/css-view-transitions/
https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API
https://ics.media/entry/230510/
https://html.spec.whatwg.org/multipage/nav-history-apis.html#navigation-api
https://developer.mozilla.org/en-US/docs/Web/API/Navigation_API
https://blog.jxck.io/entries/2022-04-22/navigation-api.html
https://developer.chrome.com/blog/spa-view-transitions-land/#transitions-across-documents
