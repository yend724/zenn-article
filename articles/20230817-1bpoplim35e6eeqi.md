---
title: 'View Transitions API ã¨ Navigation API ã§ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹'
emoji: 'ğŸ“š'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['HTML', 'CSS', 'JavaScript']
published: true
---

Chrome 102 ä»¥é™ã§ **Navigation API** ãŒã€Chrome 111 ä»¥é™ã§ **View Transitions API** ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚ æœ¬è¨˜äº‹ã§ã¯ã“ã®äºŒã¤ã® API ã‚’ç”¨ã„ã¦ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

:::message
ã“ã®è¨˜äº‹ãŒåŸ·ç­†ã•ã‚ŒãŸ 2023 å¹´ 8 æœˆ 17 æ—¥ç¾åœ¨ã§ã¯ã€View Transitions API ã¨ Navigation API ã¯ã¾ã é™ã‚‰ã‚ŒãŸãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ç¯„å›²ã§ã—ã‹ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã¯ã€ã€Œ[Can I use... Support tables for HTML5, CSS3, etc](https://caniuse.com/)ã€ã¨ã„ã£ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚
:::
https://caniuse.com/mdn-api_navigation
https://caniuse.com/view-transitions

## ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆ&ã‚³ãƒ¼ãƒ‰

æœ¬è¨˜äº‹ã§ã¯ä»¥ä¸‹ã®ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã¨ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«èª¬æ˜ã‚’è¡Œã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å…¨ä½“çš„ãªæŒ™å‹•ã‚„ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸã„éš›ã«ã¯ä»¥ä¸‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

https://vta-and-na.yend.dev/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo

## View Transitions API

View Transitions API ã¯ç•°ãªã‚‹ DOM çŠ¶æ…‹é–“ã«ãŠã‘ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ç”»é¢é·ç§»ã¨ DOM ã®æ›´æ–°ã‚’ã€å¾“æ¥ã‚ˆã‚Šã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ã§æä¾›ã™ã‚‹ API ã§ã™ã€‚

View Transitions API ã®è©³ç´°ãªèª¬æ˜ã«ã¤ã„ã¦ã¯ [View Transitions API - Web APIs | MDN](https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API) ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

æœ¬è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ View Transitions API ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

https://vta-and-na.yend.dev/view-transitions-api/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/view-transitions-api

:::details View Transitions API ã®ãƒ‡ãƒ¢ç”»é¢ã®ã‚­ãƒ£ãƒ—ãƒãƒ£
![View Transitions APIã®ãƒ‡ãƒ¢ç”»é¢](/images/20230817/view-transitions-api.webp)
:::

### View Transitions API ã‚’ç”¨ã„ãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

ã§ã¯æ—©é€Ÿã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚HTML ã®æ§‹é€ ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```html:HTML
<!-- æ›¸ç±ä¸€è¦§ç”»é¢ -->
<main class="main" data-transition-wrapper="book-index">
  <h1 class="page-title">æ›¸ç±ä¸€è¦§</h1>
  <div class="container">
    <div class="book-index-list">
      <article class="book">
        <a class="book-link link" href="/view-transitions-api/?page=book-detail">
          <img class="thumbnail" data-view-transition-name="thumbnail" src="..." />
          <h2 class="book-title" data-view-transition-name="title">å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>
          <div class="book-author">å¤ç›® æ¼±çŸ³</div>
        </a>
      </article>
    </div>
  </div>
</main>
<!--ã€€æ›¸ç±è©³ç´°ç”»é¢ï¼ˆåˆæœŸçŠ¶æ…‹ã¯hiddenã§éš ã—ã¦ã„ã‚‹ï¼‰ -->
<main class="main" data-transition-wrapper="book-detail" hidden>
  <h1 class="page-title">æ›¸ç±è©³ç´°</h1>
  <div class="container">
    <article class="book">
      <h2 class="book-title" data-view-transition-name="title">å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>
      <imgã€€class="thumbnail"ã€€data-view-transition-name="thumbnail"ã€€src="..."
      />
      <p class="book-content">å¾è¼©ã‚ãŒã¯ã„ã¯çŒ«ã§ã‚ã‚‹ã€‚åå‰ã¯ã¾ã ç„¡ã„ã€‚...</p>
      <div class="book-author">å¤ç›® æ¼±çŸ³</div>
    </article>
    <a class="link back-link" href="./">ä¸€è¦§ã¸æˆ»ã‚‹</a>
  </div>
</main>
```

ä¸Šè¨˜ã§ã¯æ›¸ç±ä¸€è¦§ç”»é¢ã¨æ›¸ç±è©³ç´°ç”»é¢ã‚’ä¸€ã¤ã® HTML ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚åˆæœŸçŠ¶æ…‹ã§ã¯æ›¸ç±è©³ç´°ç”»é¢ã« `hidden` å±æ€§ã‚’ä»˜ä¸ã—ã€`display:none` ã§è¦ç´ ã®è¡¨ç¤ºã‚’æ¶ˆã—ã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ã€ã“ã®äºŒã¤ã®ç”»é¢ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã§ã€æ“¬ä¼¼çš„ã«ãƒšãƒ¼ã‚¸é·ç§»ã‚’è¡Œãªã£ã¦ã„ã‚‹ã¨è€ƒãˆã¦ãã ã•ã„ã€‚

æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ç”»é¢é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã® JavaScript ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```js:JavaScript
// startViewTransition ã®å®Ÿè¡Œ
const swap = async (from, to) => {
  return document.startViewTransition(() => {
    from.hidden = true;
    to.hidden = false;
  }).updateCallbackDone;
};

const findAnchorElement = element => {
  if (element.tagName === 'A') {
    return element;
  }
  return null;
};
const findParentAnchorElement = element => {
  return element.closest('a');
};

// ç”»é¢è¦ç´ ã®å–å¾—
const bookIndexPage = document.querySelector(
  '*[data-transition-wrapper="book-index"]'
);
const bookDetailPage = document.querySelector(
  '*[data-transition-wrapper="book-detail"]'
);
const pageList = [bookIndexPage, bookDetailPage];

const documentBody = document.body;
documentBody.addEventListener('click', async e => {
  const target = e.target;

  // aè¦ç´ ï¼ˆãƒªãƒ³ã‚¯ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‹ã®åˆ¤åˆ¥
  const anchorElement =
    findAnchorElement(target) || findParentAnchorElement(target);

  // aè¦ç´ ã§ã‚ã‚Œã°ç”»é¢é·ç§»ã™ã‚‹
  if (anchorElement) {
    e.preventDefault();
    const url = new URL(anchorElement.href);
    const params = url.searchParams;
    const nextPage = params.get('page') ?? 'book-index';
    const nextSwapList =
      nextPage === 'book-index' ? pageList : [...pageList].reverse();
    await swap(...nextSwapList);
  }
});
```

è‚ã¨ãªã‚‹ã®ã¯ `swap()` é–¢æ•°ã§ã™ã€‚`swap()` é–¢æ•°ã®ä¸­ã§ View Transitions API ã® `document.startViewTransition(updateCallback)` ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```js:JavaScript
// document.startViewTransition ã®å®Ÿè¡Œ
const swap = async (from, to) => {
  return document.startViewTransition(() => {
    // DOM ã®æ›´æ–°å‡¦ç†
    // æ›¸ç±ä¸€è¦§ç”»é¢ã¨æ›¸ç±è©³ç´°ç”»é¢ã®åˆ‡ã‚Šæ›¿ãˆ
    from.hidden = true;
    to.hidden = false;
  }).updateCallbackDone;
};
```

`startViewTransition(updateCallback)` ã® `updateCallback` ã«ã¯ã€DOM ã®æ›´æ–°å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ä»Šå›ã®ãƒ‡ãƒ¢ã§ã¯ã€æ›¸ç±ä¸€è¦§ç”»é¢ã¨æ›¸ç±è©³ç´°ç”»é¢ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚

é©šãã¹ãã“ã¨ã«ã€ãŸã£ãŸã“ã‚Œã ã‘ã®è¨˜è¿°ã§ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¼´ã£ãŸ DOM ã®æ›´æ–°ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

```js:JavaScript
// aè¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«`swap()`ã‚’å®Ÿè¡Œã™ã‚‹
if (anchorElement) {
  e.preventDefault();
  const url = new URL(anchorElement.href);
  const params = url.searchParams;
  const nextPage = params.get('page') ?? 'book-index';
  const nextSwapList =
    nextPage === 'book-index' ? pageList : [...pageList].reverse();
  await swap(...nextSwapList);
}
```

å¾Œã¯ `aè¦ç´ ` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã« `swap()` ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚æ›¸ç±ä¸€è¦§ç”»é¢ã¨æ›¸ç±è©³ç´°ç”»é¢ã¨ã®é–“ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ç”»é¢é·ç§»ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

ã“ã“ã§ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã®æŒ™å‹•ã‚’è¦³å¯Ÿã—ã¦ã¿ã‚‹ã¨ã€ç”»é¢å…¨ä½“ã®ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰é·ç§»ï¼ˆ`mainè¦ç´ ` å…¨ä½“ã®é·ç§»ï¼‰ã¨ã€ç•°ãªã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ã„ã‚‹è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã«æ°—ä»˜ãã¨æ€ã„ã¾ã™ã€‚

å…·ä½“çš„ã«ç•°ãªã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ã¦ã„ã‚‹è¦ç´ ã¯æ¬¡ã®äºŒã¤ã«ãªã‚Šã¾ã™ã€‚

```html
<!-- æ›¸ç±ã‚¿ã‚¤ãƒˆãƒ« -->
<h2 class="book-title" data-view-transition-name="title">å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>

<!-- ã‚µãƒ ãƒã‚¤ãƒ« -->
<img class="thumbnail" data-view-transition-name="thumbnail" src="..." />
```

ä¸Šè¨˜ã®è¦ç´ ã¯ç”»é¢é·ç§»é–“ã§ã€è¦ç´ è‡ªä½“ãŒï¼ˆã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ã§ãªãï¼‰ç§»å‹•ã‚‚ã—ãã¯æ‹¡å¤§ãƒ»ç¸®å°ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚ã“ã‚Œã‚‰ã®è¦ç´ ã«å¯¾ã—ã¦é©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```css:CSS
*[data-view-transition-name] {
  contain: paint;
}
/* View Transitions API */
*[data-view-transition-name="title"] {
  view-transition-name: title;
}
*[data-view-transition-name="thumbnail"] {
  view-transition-name: thumbnail;
}
```

`view-transition-name` ã¨ã„ã†è¦‹æ…£ã‚Œãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚Šã¾ã™ã€‚å®Ÿã¯ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã€äºŒã¤ã®è¦ç´ ãŒç‹¬ç«‹ã—ãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œãªã£ã¦ã„ãŸè¦å› ã§ã™ã€‚`view-transition-name` ãŒé·ç§»å‰ã¨é·ç§»å¾Œã®ä¸¡æ–¹ã«ã‚ã‚‹å ´åˆã€ãã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒå½“ãŸã£ãŸè¦ç´ ã¯ç‹¬ç«‹ã—ãŸç”»é¢é·ç§»ã¨ãªã‚Šã¾ã™ã€‚

:::message
ãŸã ã— `view-transition-name` ã®å€¤ã¯ç”»é¢ã”ã¨ã«ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
:::

### ç”»é¢é·ç§»ã®æµã‚Œ

ã“ã“ã§ View Transitions API ã«ã‚ˆã‚‹ç”»é¢é·ç§»ã®æµã‚Œã«ã¤ã„ã¦ã–ã£ãã‚Šç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

::: message
å³å¯†ãªãƒ©ã‚¤ãƒ•ãƒ©ã‚µã‚¤ã‚¯ãƒ«ã«ã¤ã„ã¦ã¯æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã€‚
https://drafts.csswg.org/css-view-transitions/#lifecycle
:::

View Transitions API ã«ã‚ˆã‚‹ç”»é¢é·ç§»ã¯ã€æ¬¡ã®æµã‚Œã«æ²¿ã£ã¦è¡Œã‚ã‚Œã¾ã™ã€‚

1. é–‹ç™ºè€…ãŒ `document.startViewTransition(updateCallback)` ã‚’å®Ÿè¡Œã™ã‚‹
2. ã€Œå¤ã„ã€çŠ¶æ…‹ã¨ã—ã¦ã€ç¾åœ¨ã®ç”»é¢ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹
3. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒä¸€æ™‚åœæ­¢ã•ã‚‹
4. `updateCallback` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
5. ã€Œæ–°ã—ã„ã€çŠ¶æ…‹ã¨ã—ã¦ã€ç¾åœ¨ã®ç”»é¢ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹
6. é·ç§»æ“¬ä¼¼è¦ç´ ï¼ˆ`::view-transition`ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ä¸€é€£ã®æ“¬ä¼¼è¦ç´ ãƒ„ãƒªãƒ¼ï¼‰ãŒä½œæˆã•ã‚Œã‚‹
7. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä¸€æ™‚åœæ­¢ãŒè§£é™¤ã•ã‚Œã€æ“¬ä¼¼è¦ç´ ãŒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ãªãŒã‚‰é·ç§»ã™ã‚‹
8. é·ç§»ãŒå®Œäº†ã—ãŸã‚‰ã€æ“¬ä¼¼è¦ç´ ã¯å‰Šé™¤ã•ã‚Œã‚‹

View Transitions API ã¯ç”»é¢é·ç§»ã®å‰å¾Œã§ã€çŠ¶æ…‹ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«çš„ãªã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚ä¸Šè¨˜ã®æµã‚Œã‹ã‚‰åˆ†ã‹ã‚‹ã‚ˆã†ã«ã€ç”»é¢é·ç§»ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã™ã‚‹ã®ã¯é·ç§»æ“¬ä¼¼è¦ç´ ã¨å‘¼ã°ã‚Œã‚‹ä¸€é€£ã®æ“¬ä¼¼è¦ç´ ãƒ„ãƒªãƒ¼ã§ã™ã€‚å®Ÿéš›ã« Chrome DevTools ã§ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®éš›ã« `htmlè¦ç´ ` ã®ç›´ä¸‹ã«ã€æ¬¡ã®ã‚ˆã†ãªæ§‹é€ ã®æ“¬ä¼¼è¦ç´ ãƒ„ãƒªãƒ¼ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```
::view-transition
â”œâ”€ ::view-transition-group(root)
â”‚  â””â”€ ::view-transition-image-pair(root)
â”‚     â”œâ”€ ::view-transition-old(root)
â”‚     â””â”€ ::view-transition-new(root)
â””â”€ â€¦other groupsâ€¦
```

é·ç§»æ“¬ä¼¼è¦ç´ ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚

- [::view-transition](https://drafts.csswg.org/css-view-transitions/#selectordef-view-transition) ã¯ç”»é¢é·ç§»ãƒ„ãƒªãƒ¼ã®ãƒ«ãƒ¼ãƒˆã¨ãªã‚‹æ“¬ä¼¼è¦ç´ ã§ã™ã€‚
- [::view-transition-group()](https://drafts.csswg.org/css-view-transitions/#selectordef-view-transition-group) ã¯å˜ä¸€ã®ç”»é¢é·ç§»ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¡¨ã—ã€ç”»é¢é·ç§»åã”ã¨ã« `::view-transition` ã®å­è¦ç´ ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã€[::view-transition-image-pair()](https://drafts.csswg.org/css-view-transitions/#selectordef-view-transition-image-pair) ã‚’å«ã¿ã¾ã™ã€‚
- [::view-transition-old()](https://drafts.csswg.org/css-view-transitions/#selectordef-view-transition-old) ã¯ã€Œå¤ã„ã€çŠ¶æ…‹ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«çš„ãªã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ã™ã€‚
- [::view-transition-new()](https://drafts.csswg.org/css-view-transitions/#selectordef-view-transition-new) ã¯ã€Œæ–°ã—ã„ã€çŠ¶æ…‹ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«çš„ãªã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ã™ã€‚

é·ç§»æ“¬ä¼¼è¦ç´ ã«å¯¾ã—ã¦ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```css:ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹
@keyframes fade-in {
  from { opacity: 0; }
}
@keyframes fade-out {
  to { opacity: 0; }
}

@keyframes slide-from-right {
  from { transform: translateX(30px); }
}
@keyframes slide-to-left {
  to { transform: translateX(-30px); }
}

::view-transition-old(root) {
  animation: 90ms cubic-bezier(0.4, 0, 1, 1) both fade-out,
    300ms cubic-bezier(0.4, 0, 0.2, 1) both slide-to-left;
}
::view-transition-new(root) {
  animation: 210ms cubic-bezier(0, 0, 0.2, 1) 90ms both fade-in,
    300ms cubic-bezier(0.4, 0, 0.2, 1) both slide-from-right;
}
```

### åå‰ä»˜ãç”»é¢é·ç§»

CSS ã® `view-transition-name` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹ç”»é¢é·ç§»ã®ä¸­ã§ç‰¹å®šã®è¦ç´ ã«ã‚¿ã‚°ä»˜ã‘ã‚’è¡Œã„ã€æŒ‡å®šã—ãŸåå‰ã§è¦ç´ ã‚’å€‹åˆ¥ã«ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã—ã¾ã™ã€‚ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã•ã‚ŒãŸè¦ç´ ã¯ã€ãƒšãƒ¼ã‚¸å…¨ä½“ã®é·ç§»ã¨ã¯ç‹¬ç«‹ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒ–ã•ã‚Œã¾ã™ã€‚

ãƒ‡ãƒ¢ã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦ `view-transition-name` ã¯æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã—ã¦ã„ã¾ã—ãŸã€‚

```css:CSS
*[data-view-transition-name="title"] {
  view-transition-name: title;
}
*[data-view-transition-name="thumbnail"] {
  view-transition-name: thumbnail;
}
```

`view-transition-name` ã‚’æŒ‡å®šã—ãŸå ´åˆã€`root` ä»¥å¤–ã«ã‚‚ `::view-transition-group()` ãŒä½œæˆã•ã‚Œã¾ã™ã€‚æœ¬è¨˜äº‹ã®ãƒ‡ãƒ¢ã§ã¯ `title` ã¨ `thumbnail` ã¨ã„ã†åå‰ä»˜ã‘ã‚’è¡Œãªã£ã¦ã„ãŸã®ã§ã€æ¬¡ã®ã‚ˆã†ã®ãªé·ç§»æ“¬ä¼¼è¦ç´ ãƒ„ãƒªãƒ¼ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```
::view-transition
â”œâ”€ ::view-transition-group(root)
â”‚  â””â”€ ::view-transition-image-pair(root)
â”‚     â”œâ”€ ::view-transition-old(root)
â”‚     â””â”€ ::view-transition-new(root)
â”œâ”€ ::view-transition-group(title)
â”‚  â””â”€ ::view-transition-image-pair(title)
â”‚     â”œâ”€ ::view-transition-old(title)
â”‚     â””â”€ ::view-transition-new(title)
â””â”€ ::view-transition-group(thumbnail)
   â””â”€ ::view-transition-image-pair(thumbnail)
      â”œâ”€ ::view-transition-old(thumbnail)
      â””â”€ ::view-transition-new(thumbnail)
```

`view-transition-name` ã‚’æŒ‡å®šã—ãŸè¦ç´ ã«å¯¾ã—ã¦ã‚‚ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¯å¯èƒ½ã§ã™ã€‚

```css:ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã®ä¾‹
*[data-view-transition-name="title"] {
  view-transition-name: title;
}

@keyframes fade-in {
  from { opacity: 0; }
}
@keyframes fade-out {
  to { opacity: 0; }
}

@keyframes slide-from-right {
  from { transform: translateX(30px); }
}
@keyframes slide-to-left {
  to { transform: translateX(-30px); }
}

::view-transition-old(title) {
  animation: 90ms cubic-bezier(0.4, 0, 1, 1) both fade-out,
    300ms cubic-bezier(0.4, 0, 0.2, 1) both slide-to-left;
}
::view-transition-new(title) {
  animation: 210ms cubic-bezier(0, 0, 0.2, 1) 90ms both fade-in,
    300ms cubic-bezier(0.4, 0, 0.2, 1) both slide-from-right;
}
```

ä»¥ä¸Šã§ View Transitions API ã®ãƒ‡ãƒ¢ã«ãŠã‘ã‚‹å®Ÿè£…ã‚’ç°¡å˜ã«ç¢ºèªã—ã¾ã—ãŸã€‚

ã“ã“ã¾ã§ã®ãƒ‡ãƒ¢ã§ã¯ã€ä¸€ã¤ã® HTML ãƒ•ã‚¡ã‚¤ãƒ«ã«äºŒã¤ã®ç”»é¢ã‚’è¨˜è¿°ã—ã¦ã€æ“¬ä¼¼çš„ã«ãƒšãƒ¼ã‚¸é·ç§»ã®å‹•ä½œã‚’æ¨¡å€£ã—ã¦ã„ã¾ã—ãŸã€‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€ä¸€ã¤ã® HTML ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸€ã¤ã®ç”»é¢ã‚’è¨˜è¿°ã™ã‚‹ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€`hidden` å±æ€§ã‚’ä½¿ã£ã¦ç”»é¢ã‚’ã ã—åˆ†ã‘ã™ã‚‹ã®ã§ã¯ãªãã€åˆ¥ã€…ã® HTML ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ãã®ãŸã‚ã«ã¾ãšã¯ Navigation API ã«ã¤ã„ã¦ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## Navigation API

Navigation API ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é–‹å§‹ã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã€ãŠã‚ˆã³ç®¡ç†ã‚’æä¾›ã™ã‚‹ API ã§ã™ã€‚ã¾ãŸå±¥æ­´ã‚¨ãƒ³ãƒˆãƒªã‚’èª¿ã¹ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã“ã‚Œã¯ [History API](https://developer.mozilla.org/en-US/docs/Web/API/History_API)ã‚„ [window.location](https://developer.mozilla.org/en-US/docs/Web/API/Window/location) ã®å¾Œç¶™ã¨ãªã‚Šã¾ã™ã€‚

Navigation API ã®è©³ç´°ãªèª¬æ˜ã«ã¤ã„ã¦ã¯ [Navigation API - Web APIs | MDN](https://developer.mozilla.org/en-US/docs/Web/API/Navigation_API) ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

Navigation API ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰ã«ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

https://vta-and-na.yend.dev/navigation-api/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/navigation-api

:::details Navigation API ã®ãƒ‡ãƒ¢ç”»é¢ã®ã‚­ãƒ£ãƒ—ãƒãƒ£
![Navigation APIã®ãƒ‡ãƒ¢ç”»é¢](/images/20230817/navigation-api.webp)
:::

### Navigation API ã‚’ç”¨ã„ãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

ã§ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãƒšãƒ¼ã‚¸é·ç§»ã®æŒ™å‹•ã‚’ã‚ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã€ä»Šå›ã¯äºŒã¤ã®æ›¸ç±è©³ç´°ç”»é¢ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

```html:HTML
<!-- æ›¸ç±ä¸€è¦§ç”»é¢ -->
<main class="main" data-transition-wrapper="book-index">
  <h1 class="page-title">æ›¸ç±ä¸€è¦§</h1>
  <div class="container">
    <div class="book-index-list">
      <article class="book">
        <aã€€class="book-link link"ã€€href="/navigation-api/detail/i-am-a-cat/">
          <img class="thumbnail" data-view-transition-name="thumbnail" src="..." />
          <h2 class="book-title" data-view-transition-name="title">å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>
          <div class="book-author">å¤ç›® æ¼±çŸ³</div>
        </a>
      </article>
      <article class="book">
        <a class="book-link link" href="/navigation-api/detail/rashomon/">
          <img class="thumbnail" data-view-transition-name="thumbnail" src="..." />
          <h2 class="book-title" data-view-transition-name="title">ç¾…ç”Ÿé–€</h2>
          <div class="book-author">èŠ¥å· ç«œä¹‹ä»‹</div>
        </a>
      </article>
    </div>
  </div>
</main>
```

```html:HTML
<!-- æ›¸ç±è©³ç´°ç”»é¢ï¼ˆç¾…ç”Ÿé–€ã®ç”»é¢ã‚‚åŒæ§˜ã®DOMæ§‹é€ ï¼‰-->
<main class="main" data-transition-wrapper="book-detail">
  <h1 class="page-title">æ›¸ç±è©³ç´°</h1>
  <div class="container">
    <article class="book">
      <h2 class="book-title" data-view-transition-name="title">å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>
      <img class="thumbnail" data-view-transition-name="thumbnail" src="..." />
      <p class="book-content">å¾è¼©ã‚ãŒã¯ã„ã¯çŒ«ã§ã‚ã‚‹ã€‚åå‰ã¯ã¾ã ç„¡ã„ã€‚...</p>
      <div class="book-author">å¤ç›® æ¼±çŸ³</div>
    </article>
    <a class="link back-link" href="/navigation-api/">ä¸€è¦§ã¸æˆ»ã‚‹</a>
  </div>
</main>
```

ä¸Šè¨˜ã®æ›¸ç±è©³ç´°ç”»é¢ã¯ã€Œå¾è¼©ã¯çŒ«ã§ã‚ã‚‹ã€ã®ãƒšãƒ¼ã‚¸ã«ãªã‚Šã¾ã™ãŒã€ã€Œç¾…ç”Ÿé–€ã€ã®ãƒšãƒ¼ã‚¸ã‚‚åŒæ§˜ãª DOM æ§‹é€ ã¨ãªã£ã¦ã„ã¾ã™ã€‚

Navigation API ã‚’ä½¿ç”¨ã—ãŸ JavaScript ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```js:JavaScript
// HTML ã®ãƒ‘ãƒ¼ã‚¹
const parser = new DOMParser();
const parseHTML = html => {
  return parser.parseFromString(html, 'text/html');
};
// fetch ã§HTMLã®æ–‡å­—åˆ—ã®å–å¾—
const getHTML = async url => {
  return fetch(url).then(res => res.text());
};
// è¦ç´ ã®å…¥ã‚Œæ›¿ãˆ
const swap = (from, to) => {
  from.replaceWith(to);
};

// ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã™ã‚‹ã¹ãã§ãªã„ã‚¤ãƒ™ãƒ³ãƒˆ
const shouldNotIntercept = navigationEvent => {
  // å‚è€ƒ: https://developer.chrome.com/docs/web-platform/navigation-api/#deciding-how-to-handle-a-navigation
  return (
    !navigationEvent.canIntercept ||
    navigationEvent.hashChange ||
    navigationEvent.downloadRequest ||
    navigationEvent.formData
  );
};

// Navigation API
navigation.addEventListener('navigate', e => {
  if (shouldNotIntercept(e)) return;

  const loadNextPage = async () => {
    const htmlString = await getHTML(e.destination.url);
    const parsedHTML = parseHTML(htmlString);
    const toHTML = parsedHTML.querySelector('*[data-transition-wrapper]');
    const fromHTML = document.querySelector('*[data-transition-wrapper]');
    swap(fromHTML, toHTML);
    document.title = parsedHTML.title;
  };

  // NavigateEvent ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ
  // handler ã«å‡¦ç†å†…å®¹ã‚’è¨˜è¿°
  e.intercept({ handler: loadNextPage });
});
navigation.addEventListener('navigatesuccess', e => {
  console.log(e);
});
navigation.addEventListener('navigateerror', e => {
  console.error(e);
});
```

ã“ã®ä¸­ã§ã€ã¨ã‚Šã‚ã‘é‡è¦ã«ãªã‚‹ã®ã¯æ¬¡ã®ç®‡æ‰€ã§ã™ã€‚

```js:JavaScript
// Navigation API
navigation.addEventListener('navigate', e => {
  if (shouldNotIntercept(e)) return;

  const loadNextPage = async () => {
    const htmlString = await getHTML(e.destination.url);
    const parsedHTML = parseHTML(htmlString);
    const toHTML = parsedHTML.querySelector('*[data-transition-wrapper]');
    const fromHTML = document.querySelector('*[data-transition-wrapper]');
    swap(fromHTML, toHTML);
    document.title = parsedHTML.title;
  };

  // NavigateEvent ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ
  // handler ã«å‡¦ç†å†…å®¹ã‚’è¨˜è¿°
  e.intercept({ handler: loadNextPage });
});
```

Navigation API ã¯ [`window.navigation`](https://developer.mozilla.org/en-US/docs/Web/API/Window/navigation) ã‚’ä»‹ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

[`NavigateEvent`](https://developer.mozilla.org/en-US/docs/Web/API/NavigateEvent) ã® [`intercept()`](https://developer.mozilla.org/en-US/docs/Web/API/NavigateEvent/intercept) ã¯æ–‡å­—é€šã‚ŠãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€åŒä¸€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«å¤‰æ›ã—ã¾ã™ã€‚

[`handler`](https://developer.mozilla.org/en-US/docs/Web/API/NavigateEvent/intercept#handler) ã¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®å‡¦ç†å‹•ä½œãŒã©ã†ã‚ã‚‹ã¹ãã‹ã‚’å®šç¾©ã™ã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§ã™ã€‚ã“ã“ã§ã¯ `loadNextPage()`ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

`loadNextPage()` å†…ã§ã¯ NavigateEvent ã® [`destination`](https://developer.mozilla.org/en-US/docs/Web/API/NavigateEvent/destination) ã§å¾—ãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã® URL ã‚’ã€[`fetch()`](https://developer.mozilla.org/ja/docs/Web/API/fetch) ã«æ¸¡ã—ã€å–å¾—ã—ãŸ HTML æ–‡å­—åˆ—ã‚’ [`DOMParser`](https://developer.mozilla.org/ja/docs/Web/API/DOMParser) ã§ DOM ã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚ãã®å¾Œ `swap()` é–¢æ•°ã§ã€ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ç”»é¢ã‚’æ›´æ–°ã—ã¦ã„ã¾ã™ã€‚

```js:JavaScript
const shouldNotIntercept = navigationEvent => {
  // å‚è€ƒ: https://developer.chrome.com/docs/web-platform/navigation-api/#deciding-how-to-handle-a-navigation
  return (
    !navigationEvent.canIntercept ||
    navigationEvent.hashChange ||
    navigationEvent.downloadRequest ||
    navigationEvent.formData
  );
};
```

`shouldNotIntercept()`ã«é–¢ã—ã¦ã®è©³ç´°ã¯ [Chrome Developers ã«ã‚ˆã‚‹è¨˜äº‹](https://developer.chrome.com/docs/web-platform/navigation-api/#deciding-how-to-handle-a-navigation)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã™ã¹ãã§ãªã„ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã«ã¤ã„ã¦ç¢ºèªã§ãã¾ã™ã€‚

å®Ÿéš›ã«ãƒšãƒ¼ã‚¸ã®æŒ™å‹•ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã„ãªã„ã“ã¨ã‚‚ã‚ã‚Šï¼‰ä¸€è¦‹é€šå¸¸ã® `aè¦ç´ ` ã«ã‚ˆã‚‹ãƒšãƒ¼ã‚¸é·ç§»ã¨é•ã„ãŒãªã„ã‚ˆã†ã«æ€ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

Chrome DevTools ã® Network ã‚¿ãƒ–ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€ãƒšãƒ¼ã‚¸é·ç§»ã™ã‚‹ãŸã³ã«éåŒæœŸã§æ¬¡ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ `fetch()` ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

å¾“æ¥ã®æ–¹æ³•ã§ã‚ã‚‹ History API ã§ä¼¼ãŸã‚ˆã†ãªã“ã¨ã‚’ã™ã‚‹å ´åˆã€`aè¦ç´ ` ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ãŸã‚Šã€[`history.pushState()`](https://developer.mozilla.org/ja/docs/Web/API/History/pushState) ã§å±¥æ­´ã®ç®¡ç†ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Navigation API ã®ç™»å ´ã«ã‚ˆã‚Šã“ã‚Œã‚‰ã®å‡¦ç†ãŒã€ã‚ˆã‚Šç°¡æ˜“ã§æŸ”è»Ÿã«å®Ÿç¾å¯èƒ½ã¨ãªã‚Šã¾ã—ãŸã€‚

## View Transitions API ã¨ Navigation API ã‚’çµ„ã¿åˆã‚ã›ã‚‹

ãã‚Œã§ã¯ã€View Transitions API ã¨ Navigation API ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¾ã—ã‚‡ã†ã€‚

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

View Transitions API ã¨ Navigation API ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

https://vta-and-na.yend.dev/async-transition-animation/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/async-transition-animation

:::details View Transitions API ã¨ Navigation API ãƒ‡ãƒ¢ç”»é¢ã®ã‚­ãƒ£ãƒ—ãƒãƒ£
![View Transitions API ã¨ Navigation API ãƒ‡ãƒ¢ç”»é¢](/images/20230817/async-transition-animation.webp)
:::

### View Transitions API ã¨ Navigation API ã‚’ç”¨ã„ãŸãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…

ã“ã®ãƒ‡ãƒ¢ã§ã¯ã“ã‚Œã¾ã§ã«ç™»å ´ã—ãŸ View Transitions API ã¨ Navigation API ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒä¸»ãªã®ã§ã€ã“ã‚Œã¨ã„ã£ã¦ç›®æ–°ã—ã„è©±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¨ã‚Šã‚ã‘ã‚³ãƒ¼ãƒ‰ã«é–¢ã—ã¦ã¯ã€ã»ã¼ã»ã¼å¤‰æ›´ãŒãªã„ã®ã§å¤‰æ›´ãŒã‚ã‚‹ç®‡æ‰€ã®ã¿æŠœç²‹ã—ã¦è¨˜è¼‰ã—ã¾ã™ã€‚

```html:æ›¸ç±ä¸€è¦§ç”»é¢
<!-- æ›¸ç±ä¸€è¦§ç”»é¢ -->
<article class="book">
  <a class="book-link link" href="/async-transition-animation/detail/i-am-a-cat/"
  >
    <img
      class="thumbnail" data-view-transition-name="thumbnail" style="--view-transition-name: thumbnail-1" src="..."
    />
    <h2 class="book-title" data-view-transition-name="title" style="--view-transition-name: title-1"
    >å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>
    <div class="book-author">å¤ç›® æ¼±çŸ³</div>
  </a>
</article>
<article class="book">
  <a class="book-link link" href="/async-transition-animation/detail/rashomon/">
    <img class="thumbnail" data-view-transition-name="thumbnail" style="--view-transition-name: thumbnail-2" src="..." />
    <h2 class="book-title" data-view-transition-name="title" style="--view-transition-name: title-2">ç¾…ç”Ÿé–€</h2>
    <div class="book-author">èŠ¥å· ç«œä¹‹ä»‹</div>
  </a>
</article>
```

```html:æ›¸ç±è©³ç´°ç”»é¢
<!-- æ›¸ç±è©³ç´°ç”»é¢ -->
<article class="book">
  <h2 class="book-title" data-view-transition-name="title" style="--view-transition-name: title-1"
  >å¾è¼©ã¯çŒ«ã§ã‚ã‚‹</h2>
  <img class="thumbnail" data-view-transition-name="thumbnail" style="--view-transition-name: thumbnail-1" src="..." />
  <p class="book-content"> å¾è¼©ã‚ãŒã¯ã„ã¯çŒ«ã§ã‚ã‚‹ã€‚åå‰ã¯ã¾ã ç„¡ã„ã€‚... </p>
  <div class="book-author">å¤ç›® æ¼±çŸ³</div>
</article>
```

```css:CSS
/* View Transitions API */
*[data-view-transition-name] {
  view-transition-name: var(--view-transition-name);
  contain: paint;
}
/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ™‚é–“èª¿æ•´ */
::view-transition-group(*),
::view-transition-old(*),
::view-transition-new(*) {
  animation-duration: 1s;
}
```

`view-transition-name` ã«ã¤ã„ã¦ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚`view-transition-name` ã®å€¤ã¯ä¸€ã¤ã®ç”»é¢ã«ã¤ãã€ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šä¸€è¦§ç”»é¢ã§ã¯ã‚¿ã‚¤ãƒˆãƒ«ã”ã¨ã€ãŠã‚ˆã³ã‚µãƒ ãƒã‚¤ãƒ«ã”ã¨ã« `view-transition-name` ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ä»Šå›ã¯ CSS å¤‰æ•°ï¼ˆ`--view-transition-name`ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€è¦ç´ ã”ã¨ã«ä¸€æ„ãªåå‰ã‚’ã¤ã‘ã¦ã„ã¾ã™ã€‚

```js:JavaScript
// View Transitions API
const swap = (from, to) => {
  return document.startViewTransition(() => {
    from.replaceWith(to);
  }).updateCallbackDone;
};
```

JavaScript ã¯ã€Navigation API ã®ãƒ‡ãƒ¢ã‹ã‚‰ã»ã¨ã‚“ã©å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“ãŒã€`swap()` ã®ä¸­èº«ã‚’ `document.startViewTransition()` å†…ã§å‡¦ç†ã—ã¦ã„ã¾ã™ã€‚

View Transitions API ã¨ Navigation API ã‚’åˆ©ç”¨ã—ãŸãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¢ã«é–¢ã™ã‚‹èª¬æ˜ã¯ä»¥ä¸Šã§ã™ã€‚å®Ÿéš›ã«ãƒšãƒ¼ã‚¸é·ç§»ã®æŒ™å‹•ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€éåŒæœŸã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ç”»é¢é·ç§»ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

## Cross Document View Transitions

ã“ã“ã§ã€ã•ã‚‰ã«ã‚‚ã†ä¸€æ­©å…ˆã«é€²ã‚“ã  [Cross Document View Transitions](https://github.com/WICG/view-transitions/blob/main/cross-doc-explainer.md) ã®è©±é¡Œã«ã¤ã„ã¦ã‚‚è§¦ã‚Œã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

:::message
Cross Document View Transitions ã®å†…å®¹ã¯ã€æœ¬è¨˜äº‹åŸ·ç­†æ™‚ç‚¹ï¼ˆ2023.8.17ï¼‰ã«ãŠã„ã¦ã€Google Chrome ã® [chrome://flags/#view-transition-on-navigation](chrome://flags/#view-transition-on-navigation) ã‚’ Enabled ã«ã™ã‚‹ã“ã¨ã§ç¢ºèªã§ãã¾ã™ã€‚
:::

### ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰

Cross Document View Transitions ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸&ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

https://view-transitions-api-and-navigation-api-demo.pages.dev/cross-document-view-transitions/
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/tree/main/src/cross-document-view-transitions

:::details Cross Document View Transitions ã®ãƒ‡ãƒ¢ç”»é¢ã®ã‚­ãƒ£ãƒ—ãƒãƒ£
![Cross Document View Transitionsã®ãƒ‡ãƒ¢ç”»é¢](/images/20230817/cross-document-view-transitions.webp)
:::

### MPA ã§ã®ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

ã“ã‚Œã¾ã§ã«è§¦ã‚Œã¦ããŸ View Transitions API ã¯ä¸»ã«åŒä¸€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€SPA (Single-page application) å‘ã‘ã®å†…å®¹ã§ã—ãŸã€‚ã¤ã¾ã‚Š MPAï¼ˆMulti-Page Applicationï¼‰ã§ã¯ä½¿ç”¨ã§ããšã€ãƒšãƒ¼ã‚¸é–“ã§ç”»é¢é·ç§»ã‚’è¡Œã„ãŸã„å ´åˆã¯ `fetch()` ã§**éåŒæœŸçš„**ã«æ¬¡ã®ãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

ä¸€æ–¹ã§ View Transitions API ã®ç•°ãªã‚‹ãƒšãƒ¼ã‚¸ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰é–“ã§ã®å¯¾å¿œã‚‚è€ƒãˆã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã€ç¾æ™‚ç‚¹ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« `metaã‚¿ã‚°` ã‚’å®£è¨€ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```html
<meta name="view-transition" content="same-origin" />
```

å®Ÿéš›ã«ã€å˜ç´”ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ã®é·ç§»ã‚’ã™ã‚‹ã ã‘ã§ã‚ã‚Œã° JavaScript ã®è¨˜è¿°ã™ã‚‰ä¸è¦ã«ãªã‚Šã¾ã™ï¼ˆ `fetch()` ã‚‚ä¸è¦ã§ã™ï¼‰ã€‚

æŒ™å‹•ã‚’ç¢ºèªã—ãŸã„æ–¹ã¯å‰è¿°ã—ãŸé€šã‚Š `chrome://flags/#view-transition-on-navigation` ã‚’ Enabled ã«ã—ã¦ã€[ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸](https://view-transitions-api-and-navigation-api-demo.pages.dev/cross-document-view-transitions/)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ã“ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã§ã¯ `fetch()` ã®å‡¦ç†ã‚’è¡Œãªã£ã¦ã„ãªã„ã®ã«ã‚‚é–¢ã‚ã‚‰ãšã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ãƒšãƒ¼ã‚¸é·ç§»ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚

https://github.com/yend724/view-transitions-api-and-navigation-api-demo/blob/main/src/cross-document-view-transitions/index.html#L7
https://github.com/yend724/view-transitions-api-and-navigation-api-demo/blob/main/src/cross-document-view-transitions/assets/js/main.js#L1-L2

ã“ã‚Œã¯å®Ÿéš›ã« MPA ã®æŒ™å‹•ã§å®Ÿç¾ã•ã‚Œã¦ãŠã‚Šã€Chrome DevTools ã® Network ã‚¿ãƒ–ã‚’ç¢ºèªã—ã¦ã‚‚ã€**åŒæœŸçš„**ã«ãƒšãƒ¼ã‚¸é·ç§»ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

## çµ‚ã‚ã‚Šã«

ã“ã®è¨˜äº‹ã§ã¯ã€View Transitions API ã¨ Navigation API ã‚’ç”¨ã„ãŸãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

æœ€åˆã« Cross Document View Transitions ã®å†…å®¹ã‚’èª­ã‚“ã ã¨ãã¯ã€JavaScript ã®è¨˜è¿°ã™ã‚‰ä¸è¦ã«ãªã‚‹ã®ã‹ã¨è¡æ’ƒã§ã—ãŸã€‚ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚‚è€ƒæ…®ã™ã‚‹ã¨ã€åºƒãã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã¾ã§ã«ã¯ã‚‚ã†å°‘ã—æ™‚é–“ãŒã‹ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¼•ãç¶šãã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

## å‚è€ƒ

https://drafts.csswg.org/css-view-transitions/
https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API
https://ics.media/entry/230510/
https://zenn.dev/yhatt/articles/cfa6c78fabc8fa
https://html.spec.whatwg.org/multipage/nav-history-apis.html#navigation-api
https://developer.mozilla.org/en-US/docs/Web/API/Navigation_API
https://blog.jxck.io/entries/2022-04-22/navigation-api.html
https://developer.chrome.com/blog/spa-view-transitions-land/#transitions-across-documents
