---
title: "ã€JavaScriptã€‘Proxyã«ã¤ã„ã¦å­¦ã¶"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["JavaScript"]
published: true
---

ãªã‚“ã¨ãªãèã„ãŸã“ã¨ã¯ã‚ã‚‹ã‘ã©ã€ã‚ã¾ã‚Šã‚ˆãã‚ã‹ã‚‰ãªã„JavaScriptã®æŠ€è¡“ã®1ã¤ã¨ã—ã¦ã€**Proxy**ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚~~ï¼ˆã‚‚ã—ã‹ã—ãŸã‚‰ç§ã ã‘ï¼‰~~
ãã‚“ãªProxyã«ã¤ã„ã¦æ”¹ã‚ã¦å­¦ã³ç›´ã—ãŸã®ã§ã€æœ¬è¨˜äº‹ã¯ãã®ã¾ã¨ã‚ã§ã™ã€‚

# åŸºæœ¬çš„ãªä½¿ã„æ–¹

Proxyã‚’ä½¿ç”¨ã™ã‚‹ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åŸºæœ¬çš„ãªæ“ä½œã‚’æ‹¡å¼µã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã¾ãšã¯ç°¡å˜ã«ä½¿ã„æ–¹ã‚’ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
Proxyã¯ç¬¬1å¼•æ•°ã«`target`ã€ç¬¬2å¼•æ•°ã«`handler`ã®2ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚

- `target`: ã‚‚ã¨ã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `handler`: ç‰¹å®šã®æ“ä½œã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã™ã‚‹ã€ã¾ãŸã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ãŸæ“ä½œã®å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```js
// ã‚‚ã¨ã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
const target = {
  hoge: "fuga",
};
// å‹•ä½œã‚’å®šç¾©ã™ã‚‹handlerã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
const handler = {};

// Proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
const proxy = new Proxy(target, handler);

// handlerãŒç©ºãªã®ã§ã€proxyã¯ã‚‚ã¨ã®targetã¨åŒæ§˜ã®å‹•ä½œã‚’ã™ã‚‹
console.log(proxy.hoge); // "fuga"
console.log(proxy.piyo); // undefined
proxy.hoge = "piyo";
console.log(proxy.hoge); // "piyo"
console.log(target); // { hoge: 'piyo' }
```

ä¸Šè¨˜ã§ã¯`handler`ãŒç©ºã®ãŸã‚ã€`proxy`ãŒã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ`target`ï¼‰ã¨åŒæ§˜ã®å‹•ä½œã‚’ã—ã¾ã™ã€‚

ã“ã®ã¾ã¾ã§ã¯ã‚ã¾ã‚Šæ„å‘³ãŒãªã„ã®ã§ã€`handler`ã«é©åˆ‡ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ãã®æŒ™å‹•ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãŸ`handler`ã§å®šç¾©ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®ã“ã¨ã‚’ã€Proxyã§ã¯ã—ã°ã—ã°**ãƒˆãƒ©ãƒƒãƒ—**ã¨å‘¼ã³ã¾ã™ã€‚

```js
const target = {
  hoge: "fuga",
};
// handlerã«getãƒˆãƒ©ãƒƒãƒ—ã‚’å®šç¾©
const handler = {
  get: (target, prop, receiver)ã€€=> {
    return "hello";
  },
};

const proxy = new Proxy(target, handler);

proxy.hoge = "piyo";
console.log(proxy.hoge); // "hello"
console.log(target.hoge); // "piyo"
```

ä»Šå›ã¯`handler`ã«`getãƒˆãƒ©ãƒƒãƒ—`ã‚’å®šç¾©ã—ã¾ã—ãŸã€‚
æ³¨ç›®ã—ã¦ã»ã—ã„ã®ã¯`console.log(proxy.hoge)`ã®éƒ¨åˆ†ã§ã™ã€‚
é©šãã¹ãã“ã¨ã«ã€Œhelloã€ãŒçµæœã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã­ã€‚

æƒ³åƒãŒã¤ã„ã¦ã„ã‚‹æ–¹ã‚‚å¤šã„ã¨æ€ã„ã¾ã™ãŒã€`getãƒˆãƒ©ãƒƒãƒ—`ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å–å¾—ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ã¾ã™ã€‚ã™ãªã‚ã¡ä¸Šè¨˜ã®å®Ÿè£…ã§ã¯ã€å®Ÿéš›ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ãŒä½•ã§ã‚ã‚ã†ã¨å¸¸ã«ã€Œhelloã€ãŒè¿”ã£ã¦ãã‚‹ã®ã§ã™ã€‚

ã“ã“ã§æ°—ã‚’ã¤ã‘ã¦ã»ã—ã„ã®ã¯ã€ã“ã®ä¾‹ã§ã¯ã‚ãã¾ã§Proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å–å¾—ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ãŸã ã‘ã§ã‚ã£ã¦ã€`target.hoge`ã®å€¤ãŒã€Œhelloã€ã«ãªã£ãŸã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã®è¨¼æ‹ ã«`target.hoge`ã®çµæœã«ã¯`piyo`ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

proxyã¨ã„ã†è‹±å˜èªã«ã¯ã€Œä»£ç†ã€ã¨ã„ã†æ„å‘³ãŒã‚ã‚Šã¾ã™ã€‚ã“ã“ã¾ã§ã®æŒ™å‹•ã‚’çœã¿ã‚‹ã¨Proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã„ã†åå‰ã®æ„å‘³ãŒã€ãªã‚“ã¨ãªãã‚ã‹ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

# ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°

å½“ç„¶ãªãŒã‚‰`getãƒˆãƒ©ãƒƒãƒ—`ä»¥å¤–ã«ã‚‚ã€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ï¼ˆãƒˆãƒ©ãƒƒãƒ—ï¼‰ã¯å­˜åœ¨ã—ã¾ã™ã€‚ä»¥ä¸‹ã«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã‚’åˆ—æŒ™ã—ã¾ã™ã€‚

| ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ï¼ˆãƒˆãƒ©ãƒƒãƒ—ï¼‰ | å‘¼ã³å‡ºã—ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
| ---- | ---- |
| [`apply`](#applyãƒˆãƒ©ãƒƒãƒ—) | é–¢æ•°å‘¼ã³å‡ºã— |
| [`construct`](#constructãƒˆãƒ©ãƒƒãƒ—) | [new æ¼”ç®—å­](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/new) |
| [`defineProperty`](#definepropertyãƒˆãƒ©ãƒƒãƒ—) | [Object.defineProperty](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty) |
| [`deleteProperty`](#definepropertyãƒˆãƒ©ãƒƒãƒ—) | [delete æ¼”ç®—å­](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/delete) |
| [`get`](#getãƒˆãƒ©ãƒƒãƒ—) | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å–å¾— |
| [`getOwnPropertyDescriptor`](#getownpropertydescriptorãƒˆãƒ©ãƒƒãƒ—) | [Object.getOwnPropertyDescriptor](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor) |
| [`getPrototypeOf`](#getprototypeofãƒˆãƒ©ãƒƒãƒ—) | [Object.getPrototypeOf](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf) |
| [`has`](#hasãƒˆãƒ©ãƒƒãƒ—) | [in æ¼”ç®—å­](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/in) |
| [`isExtensible`](#isextensibleãƒˆãƒ©ãƒƒãƒ—) | [Object.isExtensible](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/isExtensible) |
| [`ownKeys`](#ownkeysãƒˆãƒ©ãƒƒãƒ—) | [Object.getOwnPropertyNames](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames)ã¨[Object.getOwnPropertySymbols](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols) |
| [`preventExtensions`](#preventextensionsãƒˆãƒ©ãƒƒãƒ—) | [Object.preventExtensions](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions) |
| [`set`](#setãƒˆãƒ©ãƒƒãƒ—) | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®š |
| [`setPrototypeOf`](#setprototypeofãƒˆãƒ©ãƒƒãƒ—) | [Object.setPrototypeOf](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf) |

ãŠãã‚‰ãã“ã®ä¸­ã§ã‚‚ã£ã¨ã‚‚ä½¿ç”¨é »åº¦ãŒé«˜ãã€é¦´æŸ“ã¿æ·±ã„ã®ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å–å¾—ã¨è¨­å®šã§ã—ã‚‡ã†ã€‚
ã¾ãšã¯ç†è§£ã—ã‚„ã™ã„`getãƒˆãƒ©ãƒƒãƒ—`ã‹ã‚‰è€ƒãˆã¦ã„ãã¾ã™ã€‚

## getãƒˆãƒ©ãƒƒãƒ—

å†’é ­ã§ã‚‚å‡ºã¦ãã¾ã—ãŸãŒã€`getãƒˆãƒ©ãƒƒãƒ—`ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå–å¾—ã•ã‚ŒãŸæ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `property`: å–å¾—ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å
- `receiver`: proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã¾ãŸã¯proxyã‹ã‚‰ç¶™æ‰¿ã—ã¦ã„ã‚‹å ´åˆã¯ç¶™æ‰¿ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰

ä»¥ä¸‹ã¯å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹å®Ÿè£…ã§ã™ã€‚

```js:JavasScript
const target = {
  hoge: "fuga",
};
const handler = {
  get: (target, property, receiver) => {
    if (property in target) {
      return target[property];
    }
    throw new Error("ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã—ã¾ã›ã‚“");
  },
};

const proxy = new Proxy(target, handler);
console.log(proxy.hoge); // fuga
console.log(proxy.piyo); // Uncaught Error: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã—ã¾ã›ã‚“
```

## setãƒˆãƒ©ãƒƒãƒ—

å–å¾—ãŒã‚ã‚Œã°ã€å½“ç„¶è¨­å®šã‚‚ã‚ã‚Šã¾ã™ã€‚
`setãƒˆãƒ©ãƒƒãƒ—`ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `property`: å€¤ã‚’è¨­å®šã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åï¼ˆã‚‚ã—ãã¯Symbolï¼‰
- `value`: è¨­å®šã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ–°ã—ã„å€¤
- `receiver`: proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

### æˆ»ã‚Šå€¤

`setãƒˆãƒ©ãƒƒãƒ—`ã¯**çœŸå½å€¤**ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šæ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ãŸã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```js
const target = {
  hoge: "fuga",
};
const handler = {
  set: (target, property, value, receiver) => {
    if (!(property in target)) {
      throw new Error("å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™");
      return false
    }
    if (typeof value !== "string") {
      throw new Error("æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return false
    }
    target[property] = value;
    return true
  },
};

const proxy = new Proxy(target, handler);
proxy.hoge = "piyo";
proxy.hoge = 1; // Uncaught Error: æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
```

## deletePropertyãƒˆãƒ©ãƒƒãƒ—

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å–å¾—ãƒ»è¨­å®šã¨ããŸã‚‰ã€æ¬¡ã¯å‰Šé™¤ã«ã¤ã„ã¦ã¿ã¦ã¿ã¾ã™ã€‚
`deletePropertyãƒˆãƒ©ãƒƒãƒ—`ã¯`delete æ¼”ç®—å­`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚
`delete æ¼”ç®—å­`ã‚’ä½¿ã†ã¨ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `property`: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å‰Šé™¤ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å

### æˆ»ã‚Šå€¤

`deletePropertyãƒˆãƒ©ãƒƒãƒ—`ã¯**çœŸå½å€¤**ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã¯ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§å§‹ã¾ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’`delete æ¼”ç®—å­`ã§å‰Šé™¤ã§ããªã„ã‚ˆã†ã«ã™ã‚‹å®Ÿè£…ã§ã™ã€‚

```js
const target = {
  hoge: "fuga",
  _hoge: "_fuga",
};

const handler = {
  deleteProperty(target, property) {
    if (property in target) {
      if (property.startsWith("_")) {
        console.log(`${property}ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å‰Šé™¤ã§ãã¾ã›ã‚“`);
        return false;
      }
      console.log(`${property}ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
      delete target[property];
      return true;
    }
    consoel.log(`${property}ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å­˜åœ¨ã—ã¾ã›ã‚“`);
    return false;
  },
};

const proxy = new Proxy(target, handler);
delete proxy.hoge; // hogeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
delete proxy._hoge; // _hogeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å‰Šé™¤ã§ãã¾ã›ã‚“
console.log(target); // {_hoge: '_fuga'}
```

## hasãƒˆãƒ©ãƒƒãƒ—

`hasãƒˆãƒ©ãƒƒãƒ—`ã¯`in æ¼”ç®—å­`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚
ã“ã‚Œã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã«ã‚‚ã—ã‚Œã£ã¨ç™»å ´ã—ã¦ã„ã¾ã™ãŒã€`inã€€æ¼”ç®—å­`ã¯ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã‹å¦ã‹ã‚’åˆ¤æ–­ã™ã‚‹æ¼”ç®—å­ã§ã™ã€‚æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã¨ãã¯`true`ã‚’ã€ã—ãªã„ã¨ãã¯`false`ã‚’è¿”ã—ã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `property`: å¯¾è±¡ã¨ãªã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å

### æˆ»ã‚Šå€¤

`hasãƒˆãƒ©ãƒƒãƒ—`ã¯**çœŸå½å€¤**ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®å®Ÿè£…ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã‹å¦ã‹ã«ã‹ã‹ã‚ã‚‰ãšã€å¸¸ã«`true`ã‚’è¿”ã—ã¾ã™ã€‚

```js
const target = {
  hoge: "fuga",
};

const handler = {
  has: (target, property) => {
    // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã‹å¦ã‹ã«ã‹ã‹ã‚ã‚‰ãšã€trueã‚’è¿”ã™
    return true;
  },
};

const proxy = new Proxy(target, handler);
console.log("piyo" in proxy); // trueã€€ => å®Ÿéš›ã«piyoãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã‹å¦ã‹ã«ã‚ˆã‚‰ãšã€å¸¸ã«å­˜åœ¨ã—ã¦ã„ã‚‹ã‚ˆã†ã«æŒ¯ã‚‹èˆã†
console.log(proxy.piyo); // undefined
```

ã“ã¡ã‚‰ã‚‚`getãƒˆãƒ©ãƒƒãƒ—`ã®æ™‚ã¨åŒæ§˜ã«ã€ã‚ãã¾ã§`in æ¼”ç®—å­`ã®æ“ä½œã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ã¦ã„ã‚‹ã ã‘ã§ã‚ã‚Šã€`proxy.piyo`ã¯`undefined`ã¨ãªã‚Šã¾ã™ã€‚

## ownKeysãƒˆãƒ©ãƒƒãƒ—

`ownKeysãƒˆãƒ©ãƒƒãƒ—`ã¯`Object.getOwnPropertyNames`ã¨`Object.getOwnPropertySymbols`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚

`Object.getOwnPropertyNames`ã¯å¯¾è±¡ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸Šã®ã‚·ãƒ³ãƒœãƒ«ã‚’é™¤ãã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã€`Object.getOwnPropertySymbols`ã¯å¯¾è±¡ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸Šã®ã™ã¹ã¦ã®ã‚·ãƒ³ãƒœãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é…åˆ—ã§è¿”ã—ã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒæ¸¡ã£ã¦ãã¾ã™ã€‚

- `object`: åˆ—æŒ™ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

### æˆ»ã‚Šå€¤

`ownKeysãƒˆãƒ©ãƒƒãƒ—`ã¯åˆ—æŒ™å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã¯ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§å§‹ã¾ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é™¤ã„ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§ã‚’è¿”ã™å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚

```js
const target = {
  hoge: "fuga",
  _hoge: "_fuga",
  [Symbol("piyo")]: "piyo",
};
const handler = {
  ownKeys: (object) => {
    // ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§å§‹ã¾ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é™¤ã
    return [
      ...Object.getOwnPropertyNames(object).filter(
        key => !key.startsWith("_")
      ),
      ...Object.getOwnPropertySymbols(object),
    ];
  },
};

const proxy = new Proxy(target, handler);
console.log(Object.getOwnPropertyNames(proxy)); // ['hoge'] => _hogeãŒãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã•ã‚Œã¦ã„ã‚‹
console.log(Object.getOwnPropertySymbols(proxy)); // [Symbol(piyo)]
```

ç°¡å˜ã«`ownKeysãƒˆãƒ©ãƒƒãƒ—`ã®å®Ÿè£…æ–¹æ³•ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã§ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã‚‰ãšã€å¸¸ã«`["hoge", "fuga"]`ã‚’ãƒªã‚¿ãƒ¼ãƒ³ã—ã¦ã„ã¾ã™ã€‚

```js
const handler = {
  ownKeys: object => {
    // å¸¸ã«["hoge", "fuga"]ã‚’è¿”ã™
    return ["hoge", "fuga"];
  },
};

const proxy = new Proxy({}, handler);
console.log(Object.getOwnPropertyNames(proxy)); // ['hoge', 'fuga']
console.log(Object.keys(proxy)); // [] => ç©ºã®é…åˆ—
```

æ³¨ç›®ã™ã¹ããªã®ã¯`Object.keys(proxy)`ã®éƒ¨åˆ†ã§ã™ã­ã€‚çµæœã«ã¯ç©ºã®é…åˆ—ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

ã“ã‚Œã¯ãªãœã‹ã¨ã„ã†ã¨`Object.keys`ãŒã‚ãã¾ã§**åˆ—æŒ™å¯èƒ½**ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã¿ã‚’è¿”ã™ã‹ã‚‰ã§ã™ã€‚**åˆ—æŒ™å¯èƒ½**ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã¯ã™ãªã‚ã¡`enumerableå±æ€§`ãŒ`true`ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã“ã¨ã§ã™ã€‚

`enumerableå±æ€§`ã«ã¤ã„ã¦ã¯æœ¬è¨˜äº‹ã§ã¯è§£èª¬ã—ã¾ã›ã‚“ãŒã€å‚è€ƒã¨ã—ã¦ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’è²¼ã£ã¦ãŠãã¾ã™ã€‚
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty#description

ã§ã¯**åˆ—æŒ™å¯èƒ½**ã§ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–å¾—ã™ã‚‹ã«ã¯ã©ã†ã™ã‚‹ã®ã‹ã„ã†ã¨ã€æ¬¡ã§ç´¹ä»‹ã™ã‚‹`getOwnPropertyDescriptorãƒˆãƒ©ãƒƒãƒ—`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## getOwnPropertyDescriptorãƒˆãƒ©ãƒƒãƒ—

`getOwnPropertyDescriptorãƒˆãƒ©ãƒƒãƒ—`ã¯`Object.getOwnPropertyDescriptor`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚
`Object.getOwnPropertyDescriptor`ã‚’ä½¿ã†ã¨ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨˜è¿°å­ï¼ˆãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ï¼‰ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `property`: è¨˜è¿°ã®å¯¾è±¡ã¨ãªã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã€ã¾ãŸã¯`Symbol`

### æˆ»ã‚Šå€¤

**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã€ã¾ãŸã¯`undefined`ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®å®Ÿè£…ã¯åˆ—æŒ™å¯èƒ½ã‹å¦ã‹ã«ã‹ã‹ã‚ã‚‰ãšã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```js
const target = {};
const handler = {
  ownKeys(target) {
    return ["hoge", "fuga"];
  },
  getOwnPropertyDescriptor(target, property) {
    return {
      value: property,
      writable: true,
      enumerable: true,
      configurable: true,
    };
  },
};
const proxy = new Proxy(target, handler);

console.log(Object.getOwnPropertyDescriptor(proxy, "piyo")); // {value: 'piyo', writable: true, enumerable: true, configurable: true}
console.log(Object.keys(proxy)); // ['hoge', 'fuga'] => enumerableãŒtrueãªã®ã§å–å¾—ã§ãã‚‹
```

## definePropertyãƒˆãƒ©ãƒƒãƒ—

`definePropertyãƒˆãƒ©ãƒƒãƒ—`ã¯`Object.defineProperty`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚

`Object.defineProperty`ã‚’ä½¿ã†ã¨ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨˜è¿°å­ï¼ˆãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ï¼‰ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `property`: èª¬æ˜ã‚’å—ã‘å–ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã€ã¾ãŸã¯`Symbol`
- `descriptor`: å®šç¾©ã‚„å¤‰æ›´ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã™ã‚‹ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿

### æˆ»ã‚Šå€¤

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ­£ã—ãå®šç¾©ã•ã‚ŒãŸã‹å¦ã‹ã‚’è¡¨ã™**çœŸå½å€¤**ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js
const target = { hoge: "fuga" };
const handler = {
  defineProperty: (target, key, descriptor) => {
    Object.defineProperty(target, key, descriptor);
    return true;
  },
};
const proxy = new Proxy(target, handler);

Object.defineProperty(proxy, "hoge", {
  value: "piyo",
  writable: true,
  enumerable: true,
  configurable: true,
});
console.log(Object.getOwnPropertyDescriptor(proxy, "hoge")); // {value: 'piyo', writable: true, enumerable: true, configurable: true}
```

## getPrototypeOfãƒˆãƒ©ãƒƒãƒ—

`getPrototypeOfãƒˆãƒ©ãƒƒãƒ—`ã¯`Object.getPrototypeOf`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚

`Object.getPrototypeOf`ã¯æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’å–å¾—ã§ãã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `property`: èª¬æ˜ã‚’å—ã‘å–ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã€ã¾ãŸã¯`Symbol`
- `descriptor`: å®šç¾©ã‚„å¤‰æ›´ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã™ã‚‹ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ãƒ¼

ä»¥ä¸‹ã¯ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’`Number.prototype`ã«å½ã‚‹å®Ÿè£…ã§ã™ã€‚

```js
const target = { hoge: "fuga" };
const proxy = new Proxy(target, {
  getPrototypeOf: (target) => {
    // Numberã®prototypeã‚’è¿”ã™
    return Number.prototype;
  },
});

console.log(Object.getPrototypeOf(proxy) === Number.prototype); // true
proxy.toFixed(0); // Uncaught TypeError: proxy.toFixed is not a function
```

çµæœã‚’ã¿ã¦ã‚ã‹ã‚‹ã‚ˆã†ã«ã€ã“ã‚Œã‚‚`getãƒˆãƒ©ãƒƒãƒ—`åŒæ§˜ã€ã‚ãã¾ã§ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®å–å¾—ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã—ã¦ã„ã‚‹ã ã‘ã§ã‚ã‚Šã€å®Ÿéš›ã«`proxy`ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãã®è¨¼æ‹ ã«`proxy.toFixed(0)`ã¯ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

## setPrototypeOfãƒˆãƒ©ãƒƒãƒ—

`setPrototypeOfãƒˆãƒ©ãƒƒãƒ—`ã¯`Object.setPrototypeOf`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚

`Object.setPrototypeOf`ã¯æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’è¨­å®šã§ãã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `prototype`: è¨­å®šã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã€ã¾ãŸã¯`null`

### æˆ»ã‚Šå€¤

`setPrototypeOfãƒˆãƒ©ãƒƒãƒ—`ã¯**çœŸå½å€¤**ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã¯é…åˆ—ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’`Object.prototype`ã«å¤‰æ›´ã—ã¦ã¾ã™ã€‚
ãã®è¨¼æ‹ ã«`proxy.push`ãŒã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```js
const target = [];
const proxy = new Proxy(target, {
  setPrototypeOf: (target, prototype) => {
    Object.setPrototypeOf(target, prototype);
    return true;
  },
});

Object.setPrototypeOf(proxy, Object.prototype);
proxy.push(1); // Uncaught TypeError: proxy.push is not a function
```

## isExtensibleãƒˆãƒ©ãƒƒãƒ—

`isExtensible`ã¯`Object.isExtensible`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚
`Object.isExtensible`ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ**æ‹¡å¼µå¯èƒ½**ã‹å¦ã‹ã‚’çœŸå½å€¤ã§è¿”ã—ã¾ã™ã€‚
**æ‹¡å¼µå¯èƒ½**ã¨ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ–°ã—ã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ ã§ãã‚‹çŠ¶æ…‹ã‚’æŒ‡ã—ã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒæ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

### æˆ»ã‚Šå€¤

`isExtensibleãƒˆãƒ©ãƒƒãƒ—`ã¯**çœŸå½å€¤**ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»Šã¾ã§ã®ãƒˆãƒ©ãƒƒãƒ—ã§ã¯æ“ä½œã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ï¼ˆå®Ÿéš›ã«æ­£ã—ã„æŒ™å‹•ã‹ã©ã†ã‹ã«ã‚ˆã‚‰ãšï¼‰ãã®æŒ™å‹•ã‚’å½ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ä¸€æ–¹ã§`isExtensibleãƒˆãƒ©ãƒƒãƒ—`ã¯åˆ¶é™ãŒå³ã—ãã€`Object.isExtensible`ãŒ`true`ã‚’è¿”ã™ã¹ãã¨ã“ã‚ã§`false`ã‚’è¿”ã—ãŸã‚Šã€é€†ã«`false`ã‚’è¿”ã™ã¹ãã¨ã“ã‚ã§`true`ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚
ã™ãªã‚ã¡ä»¥ä¸‹ã®å®Ÿè£…ã¯å¿…ãšã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```js
const target = {};
const handler = {
  isExtensible: (target) => {
    // Object.isExtensibleã¨ã¯é€†ã®æŒ™å‹•
    // å¿…ãšã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ï¼ï¼
    return !Object.isExtensible(target);
  },
};
const proxy = new Proxy(target, handler);
console.log(Object.isExtensible(proxy));ã€€// Uncaught TypeError: 'isExtensible' on proxy: trap result does not reflect extensibility of proxy target (which is 'true')
```

## preventExtensionsãƒˆãƒ©ãƒƒãƒ—

`preventExtensions`ãƒˆãƒ©ãƒƒãƒ—ã¯`Object.preventExtensions`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚

`Object.preventExtensions`ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’**æ‹¡å¼µä¸å¯èƒ½**ã¨ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚
**æ‹¡å¼µä¸å¯èƒ½**ã¨ãªã£ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€æ–°ã—ã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ï¼ˆãŸã ã—æ—¢å­˜ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›´ã¨å‰Šé™¤ã¯ã§ãã‚‹ï¼‰ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒæ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

### æˆ»ã‚Šå€¤

`preventExtensionsãƒˆãƒ©ãƒƒãƒ—`ã¯**çœŸå½å€¤**ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`preventExtensions`ã®æ“ä½œã«æˆåŠŸã—ãŸï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ‹¡å¼µä¸å¯èƒ½ã«ãªã£ãŸï¼‰ã¨ãã¯`true`ã€å¤±æ•—ã—ãŸã¨ãã¯`false`ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js
const target = {
  hoge: "hoge",
};
const handler = {
  preventExtensions: (target) => {
    Object.preventExtensions(target);
    return true;
  },
};

const proxy = new Proxy(target, handler);
proxy.fuga = "fuga";
// ã“ã“ã‹ã‚‰æ‹¡å¼µä¸å¯èƒ½
Object.preventExtensions(proxy);
proxy.piyo = "piyo";
console.log(target); // {hoge: 'hoge', fuga: 'fuga'} => piyoã¯è¿½åŠ ã•ã‚Œã¦ã„ãªã„
```

## applyãƒˆãƒ©ãƒƒãƒ—

`applyãƒˆãƒ©ãƒƒãƒ—`ã¯é–¢æ•°å‘¼ã³å‡ºã—ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚`new Proxy`ã®ç¬¬1å¼•æ•°ã«æ¸¡ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯é–¢æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `thisArg`: é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã®`this`
- `argumentsList`: é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã®å¼•æ•°ã®é…åˆ—

ä»¥ä¸‹ã¯é–¢æ•°å®Ÿè¡Œæ™‚ã«æ¸¡ã—ãŸå¼•æ•°ã‚’`console.log`ã§è¡¨ç¤ºã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```js
const target = (...args) => {
  console.log([...args]);
};
const handler = {
  apply: (target, thisValue, args) => {
    return target.apply(thisValue, args);
  },
};

const proxy = new Proxy(target, handler);
proxy("hoge", "fuga", "piyo"); // Â ['hoge', 'fuga', 'piyo']
```

## constructãƒˆãƒ©ãƒƒãƒ—

`constructãƒˆãƒ©ãƒƒãƒ—`ã¯`new æ¼”ç®—å­`ã«å¯¾ã™ã‚‹ãƒˆãƒ©ãƒƒãƒ—ã§ã™ã€‚`applyãƒˆãƒ©ãƒƒãƒ—`ã®æ™‚ã¨åŒæ§˜ã«ã€ã“ã®ãƒˆãƒ©ãƒƒãƒ—ã§ã¯`new Proxy`ã®ç¬¬1å¼•æ•°ã«æ¸¡ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ˆ`new`ã§ãã‚‹ï¼‰å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### å¼•æ•°

æ¬¡ã®å¼•æ•°ãŒé †ã«æ¸¡ã£ã¦ãã¾ã™ã€‚

- `target`: ã‚‚ã¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `argumentsList`: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«å¯¾ã™ã‚‹å¼•æ•°ã®é…åˆ—
- `newTarget`: Proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªèº«

### æˆ»ã‚Šå€¤

`constructãƒˆãƒ©ãƒƒãƒ—`ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js
const target = class Target {
  constructor({ firstname, lastname, age }) {
    this.firstname = firstname;
    this.lastname = lastname;
    this.age = age;
  }
  echo() {
    console.log(
      `${this.lastname}${this.firstname}ã•ã‚“ã¯${this.age}æ­³ã§ã™`
    );
  }
};
const handler = {
  construct: (target, argumentsList, newTarget) => {
    return new target(...argumentsList);
  },
};
const proxy = new Proxy(target, handler);
const person = new proxy({
  firstname: "å¤ªéƒ",
  lastname: "ä½è—¤",
  age: 20,
});
person.echo(); // ä½è—¤å¤ªéƒã•ã‚“ã¯20æ­³ã§ã™
```

# å–ã‚Šæ¶ˆã—å¯èƒ½ãªProxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆProxy.revocableï¼‰

`Proxy.revocable`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã“ã¨ã§**å–ã‚Šæ¶ˆã—å¯èƒ½ãªproxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ã„ã¾ã™ã€‚

```js
const target = {
  // ç•¥
};
const handler = {
  // ç•¥
};
const { proxy, revoke } = Proxy.revocable(target, handler);
```

åŸºæœ¬çš„ã«ã¯é€šå¸¸ã®Proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã¨åŒã˜ï¼ˆ`new Proxy`ã¨åŒã˜ï¼‰ã§ã™ãŒã€ç”Ÿæˆã•ã‚ŒãŸå–ã‚Šæ¶ˆã—å¯èƒ½ãªProxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯`proxy`ã¨`revoke`ã®2ã¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

`proxy`ã¯`new Proxy(target, handler)`ã§ç”Ÿæˆã§ãã‚‹Proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨åŒæ§˜ãªã‚‚ã®ã§ã™ã€‚
`revoke`ã¯`proxy`ã‚’ **ç„¡åŠ¹ã«ã™ã‚‹ï¼ˆå–ã‚Šæ¶ˆã™ï¼‰** ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚

`revoke`é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã®ãƒˆãƒ©ãƒƒãƒ—ã«é–¢ã‚ã‚‹æ“ä½œãŒã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```js
const target = { hoge: "fuga" };
const handler = {
  get: (target, property, receiver) => {
    return Reflect.get(target, property, receiver);
  },
};
const { proxy, revoke } = Proxy.revocable(target, handler);
console.log(proxy.hoge); // "fuga"
revoke();
console.log(proxy.hoge); // Uncaught TypeError: Cannot perform 'get' on a proxy that has been revoked
```

`proxy`ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ã¨ã€ã‚‚ã¨ã¨ãªã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å†…éƒ¨å‚ç…§ãŒãªããªã‚‹ã®ã§ã€ãƒ¡ãƒ¢ãƒªãŒç¯€ç´„ã§ãã‚‹ã¨ã„ã†ç‚¹ã§ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

# Reflect

ã“ã“ã§Proxyã¨é–¢ã‚ã‚Šã®ã‚ã‚‹**Reflect**ã«ã¤ã„ã¦ã‚‚è»½ãã¿ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

Reflectã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œã‚’è¡Œã†ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã™ã‚‹çµ„ã¿è¾¼ã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚
Reflectè‡ªä½“ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã¯ãªã„ã®ã§ã€`new`ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ï¼ˆMathã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚ˆã†ã«ï¼‰Reflectã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯é™çš„ã§ã™ã€‚

Refectã¯[Proxyã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°](#ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°)ã¨åŒã˜åå‰ã§ã€åŒã˜å¼•æ•°ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚‚ã¡ã¾ã™ã€‚ã¤ã¾ã‚ŠProxyã®ãƒˆãƒ©ãƒƒãƒ—ã¨1å¯¾1ã§å¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚‚ã£ã¦ã„ã‚‹ã®ã§ã™ã€‚

å„ã€…ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®æŒ™å‹•ã‚’1ã¤1ã¤ç¢ºèªã—ã¦ã„ãã¨ã€ã‹ãªã‚Šå†—é•·ã«ãªã£ã¦ã—ã¾ã†ï¼ˆã¾ãŸReflectã«ã¤ã„ã¦ã¯ã“ã®è¨˜äº‹ã®ç›®çš„ã§ã¯ãªã„ï¼‰ã®ã§ã€æœ¬è¨˜äº‹ã§ã¯`Relfect.get`ã ã‘ç°¡å˜ã«ç´¹ä»‹ã—ã¾ã™ã€‚

åŸºæœ¬çš„ã«ã¯Proxyã®`getãƒˆãƒ©ãƒƒãƒ—`ã¨åŒã˜å¼•æ•°ã‚’æŒã¤ã®ã§ã€`Reflect.get`ã¯æ¬¡ã®3ã¤ã®å¼•æ•°ã‚’é †ã«å–ã‚Šã¾ã™ã€‚

- `taregt`: å¯¾è±¡ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `property`: å–å¾—ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å
- `receiver`: ã‚²ãƒƒã‚¿ãƒ¼ãŒã‚ã‚‹å ´åˆã€`target`ã®å‘¼ã³å‡ºã—ã§ä½¿ç”¨ã™ã‚‹`this`ï¼ˆç¬¬3å¼•æ•°ã¯**çœç•¥å¯èƒ½**ï¼‰

```js
const target = {
  hoge: "fuga",
};
// target.hogeã¨åŒã˜
console.log(Reflect.get(tagret, 'hoge')); // "hoge"
```

ã‚·ãƒ³ãƒ—ãƒ«ãªæŒ™å‹•ã§ã™ã­ã€‚ã“ã®å ´åˆ`target.hoge`ã¨å¤‰ã‚ã‚‰ãªã„ã®ã§ã€ã‚ã¾ã‚Šãƒ¡ãƒªãƒƒãƒˆã‚’æ„Ÿã˜ã¾ã›ã‚“ãŒã€Proxyã¨Reflectã‚’ä¸€ç·’ã«ä½¿ã†ã“ã¨ã§åŠ¹æœã‚’ç™ºæ®ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

Proxyã®`getãƒˆãƒ©ãƒƒãƒ—`ã§`Reflect.get`ã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```js
const target = {
  hoge: "fuga",
};
const handler = {
  get: (target, property, receiver) => {
    // target[property]ã¨åŒã˜ï¼Ÿ
    return Reflect.get(target, property, receiver);
  },
};
const proxy = new Proxy(target, handler);
console.log(proxy.hoge); // "fuga"
```

ã“ã®å ´åˆã§ã‚‚`target[property]`ã¨ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«æ€ãˆã¾ã™ã€‚

ã§ã¯ä¸‹è¨˜ã®å ´åˆã¯ã©ã†ã§ã—ã‚‡ã†ã‹ã€‚proxyã§å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã¯`defaultValue`ãŒè¿”ã£ã¦ãã‚‹ã“ã¨æœŸå¾…ã—ãŸå®Ÿè£…ã§ã™ã€‚

```js
const target = {
  hoge: "hogeValue",
  get piyo() {
    return this.fuga;
  },
};
const handler = {
  get: (target, property, receiver) => {
    if (property in target) {
      return target[property];
    }
    return "defaultValue";
  },
};
const proxy = new Proxy(target, handler);
console.log(proxy.piyo); // undefined
```

ãªã‚“ã¨æœŸå¾…ã¨ã¯è£è…¹ã«ã€`proxy.piyo`ãŒ`undefined`ã¨ãªã‚Šã¾ã—ãŸã€‚
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ã¿ã‚‹ã¨`getãƒˆãƒ©ãƒƒãƒ—`ã§è¿”ã•ã‚Œã‚‹å€¤ãŒ`target[property]`ã§ã™ã­ã€‚
ã“ã®å ´åˆ`target.piyo`ãŒã‚²ãƒƒã‚¿ãªã®ã§ã€ãã®ä¸­ã®`this`ã¯`target`ã¨ãªã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦`target`ä¸Šã«ã¯`this.fuga`ãŒå­˜åœ¨ã›ãšã€`undefined`ãŒè¿”ã£ã¦ãã¾ã™ã€‚

ã§ã¯`defaultValue`ã‚’è¿”ã™ãŸã‚ã«ã¯ã©ã†ã™ã‚Œã°è‰¯ã„ã§ã—ã‚‡ã†ã‹ã€‚ã“ã®ã‚ˆã†ãªå ´åˆã®è§£æ±ºç­–ã¨ã—ã¦`Reflect.get`ã‚’ä½¿ã„ã¾ã™ã€‚

```diff js
  const target = {
    hoge: "hogeValue",
    get piyo() {
      return this.fuga;
    },
  };
  const handler = {
    get: (target, property, receiver) => {
      if (property in target) {
-       return target[property];
+       return Reflect.get(target, property, receiver);
      }
      return "defaultValue";
    },
  };
  const proxy = new Proxy(target, handler);
  console.log(proxy.piyo); // defaultValue
```

ä»Šåº¦ã¯æœŸå¾…é€šã‚Š`proxy.piyo`ãŒ`defaultValue`ã¨ãªã‚Šã¾ã—ãŸã€‚
è‚ã¨ãªã‚‹ã®ã¯`Reflect.get`ã®ç¬¬3å¼•æ•°ï¼ˆ`receiver`ï¼‰ã§ã™ã€‚ç¬¬3å¼•æ•°ã«æ¸¡ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã€ã‚²ãƒƒã‚¿å‘¼ã³å‡ºã—ã®éš›ã®`this`ã¨ãªã‚‹ã®ã§ã€æœŸå¾…é€šã‚Šã®æŒ™å‹•ã¨ãªã‚Šã¾ã™ã€‚

ã–ã£ãã‚Šã§ã™ãŒã€Reflectã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã“ã‚Œä»¥ä¸Šæ·±æ˜ã‚Šã¯ã—ã¾ã›ã‚“ãŒã€å‚è€ƒã¾ã§ã«MDNã®ãƒªãƒ³ã‚¯ã ã‘è¼‰ã›ã¦ãŠãã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Reflect

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

ã•ã¦ã€ã“ã“ã¾ã§Proxyï¼ˆã¨Reflectï¼‰ã®æŒ™å‹•ã«ã¤ã„ã¦ã¿ã¦ãã¾ã—ãŸã€‚
ã—ã‹ã—ã€æŒ™å‹•ãŒã‚ã‹ã£ã¦ããŸã¨ã“ã‚ã§ä½¿ã†å ´é¢ãŒæ€ã„ã¤ã‹ãªã„â€¦â€¦ãªã‚“ã¦ã“ã¨ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚å®Ÿéš›ã€ã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹ç§è‡ªèº«ã‚‚ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã‚ã¾ã‚Šæ€ã„ã¤ãã¾ã›ã‚“ã§ã—ãŸã€‚

ã¨ã„ã†ã“ã¨ã§ã€Proxyã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã„ãã¤ã‹èª¿ã¹ã¦ã¿ã¾ã—ãŸã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚

## ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å–å¾—

ã“ã‚Œã¯æ¯”è¼ƒçš„æ€ã„æµ®ã‹ã¹ã‚„ã™ã„ä½¿ã„æ–¹ã§ã™ã­ã€‚
å­˜åœ¨ã—ãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å€¤ã‚’è¿”ã™ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚

```js
const target = {
  "1th": "é‡‘ãƒ¡ãƒ€ãƒ«",
  "2th": "éŠ€ãƒ¡ãƒ€ãƒ«",
  "3th": "éŠ…ãƒ¡ãƒ€ãƒ«",
};
const handler = {
  get: (target, property, receiver) => {
    if (property in target) {
      return Reflect.get(target, property, receiver);
    }
    return "å‚åŠ è³";
  },
};

const proxy = new Proxy(target, handler);
console.log(proxy["1th"]); // é‡‘ãƒ¡ãƒ€ãƒ«
console.log(proxy["4th"]); // å‚åŠ è³
```

## ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®åŠ å·¥

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åŠ å·¥ã™ã‚‹ã“ã¨ã§ã€å¤§æ–‡å­—/å°æ–‡å­—ã‚’ã‚’åŒºåˆ¥ã›ãšã«åŒã˜å€¤ã‚’å–å¾—ã§ãã¾ã™ã€‚

```js
const handler = {
  get: (target, property, receiver) => {
    return Reflect.get(target, property.toLowerCase(), receiver);
  },
  set: (target, property, value, receiver) => {
    Reflect.set(target, property.toLowerCase(), value, receiver);
    return true;
  },
};

const proxy = new Proxy({}, handler);
proxy.hoge = "fuga";
console.log(proxy.HOGE); // "fuga"
```

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

`setãƒˆãƒ©ãƒƒãƒ—`ã®ç®‡æ‰€ã§ã‚‚æ›¸ã„ã¦ã—ã¾ã—ãŸãŒã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã®è¨­å®šæ™‚ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

```js
const target = {
  name: "ç”°ä¸­",
  age: 20,
};
const handler = {
  set: (target, property, value, receiver) => {
    if (!(property in target)) {
      console.error("æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return false;
    }
    if (property === "name" && typeof value !== "string") {
      console.error("nameã«ã¯æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return false;
    }
    if (property === "age" && typeof value !== "number") {
      console.error("ageã«ã¯æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return false;
    }

    Reflect.set(target, property, value, receiver);
    return true;
  },
};

const proxy = new Proxy(target, handler);
proxy.name = "ä½è—¤";
proxy.age = "30"; // ageã«ã¯æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
console.log(target); // {name: 'ä½è—¤', age: 20}
```

é…åˆ—ã«å¯¾ã—ã¦ã‚‚åŒæ§˜ã§ã™ã€‚

```js
const target = [0, 1, 2];
const handler = {
  set: (target, property, value, receiver) => {
    if (typeof value === "number") {
      Reflect.set(target, property, value, receiver);
      return true;
    }
    return false;
  },
};

const proxy = new Proxy(target, handler);
proxy.push(3);
proxy.push("4"); // Uncaught TypeError: 'set' on proxy: trap returned falsish for property '4'
```

## ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã¤ãã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js
const target = {
  public: "Public",
  _private: "Private",
  getPrivate: function () {
    return this._private;
  },
};
const handler = {
  get: (target, property, receiver) => {
    const value = Reflect.get(target, property, receiver);
    if (typeof value === "function") {
      return value.bind(target);
    }
    if (!property.startsWith("_")) {
      return value;
    }
    return undefined;
  },
  ownKeys: object => {
    return Reflect.ownKeys(object).filter(key => !key.startsWith("_"));
  },
  has: (target, property) => {
    if (property.startsWith("_")) {
      return false;
    }
    return Reflect.has(target, property);
  },
  set: (target, property, value, receiver) => {
    if (property.startsWith("_")) {
      console.error(`${property}ã«å€¤ã¯è¨­å®šã§ãã¾ã›ã‚“`);
      return false;
    }
    return Reflect.set(target, property, value, receiver);
  },
};

const proxy = new Proxy(target, handler);
console.log(proxy.public); // "Public"
console.log(proxy._private); // undefined
console.log("_private" in proxy); // false
console.log(proxy.getPrivate()); // Private
console.log(Object.keys(proxy)); // ['public']
proxy._private = "hoge"; // _privateã«å€¤ã¯è¨­å®šã§ãã¾ã›ã‚“
```

## ReadOnlyãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

ReadOnlyãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã¤ãã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```js
const ReadOnlyError = () => {
  throw new Error("ReadOnlyError");
};

const target = {
  hoge: "fuga",
};

const handler = {
  set: ReadOnlyError,
  defineProperty: ReadOnlyError,
  deleteProperty: ReadOnlyError,
  setPrototypeOf: ReadOnlyError,
  preventExtensions: ReadOnlyError,
};

const proxy = new Proxy(target, handler);
proxy.hoge = "piyo"; // Uncaught Error: ReadOnlyError
```

## é…åˆ—ã®ãƒã‚¤ãƒŠã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

é…åˆ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«è² ã®å€¤ã‚’å¯¾å¿œã•ã›ã‚‹ï¼ˆè² ã®å€¤ã®å ´åˆã€æœ«å°¾ã‹ã‚‰æ•°ãˆã‚‹ï¼‰ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```js
const target = ["hoge", "fuga", "piyo"];
const handler = {
  get: (target, property, receiver) => {
    const num = Number(property);
    if (num < 0) {
      const i = target.length + num;
      return Reflect.get(target, i, receiver);
    }
    return Reflect.get(target, property, receiver);
  },
};
const proxy = new Proxy(target, handler);
// ãƒã‚¤ãƒŠã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§å–å¾—ã—ãŸã‚‰ã€æœ«å°¾ã‹ã‚‰æ•°ãˆã‚‹
console.log(proxy[0]); // "hoge"
console.log(proxy[-1]); // "piyo"
console.log(proxy[-2]); // "fuga"
```

## ç”Ÿå­˜æ™‚é–“ã®ã‚ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥

TTLï¼ˆç”Ÿå­˜æ™‚é–“ï¼‰ã®ã‚ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚
ä»¥ä¸‹ã¯ä¸€å®šæ™‚é–“çµŒéå¾Œã«ã€`hoge`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨`undefined`ãŒè¿”ã£ã¦ãã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```js
const SECONDS = 5;
const start = Date.now();
const isExpired = s => {
  return Date.now() - start > s * 1000;
};

const target = {
  hoge: "fuga",
};
const handler = {
  get: (target, propetry) => {
    return isExpired(SECONDS) ? undefined : Reflect.get(target, propetry);
  },
};
const proxy = new Proxy(target, handler);

setTimeout(() => {
  console.log(proxy.hoge); // "fuga"
}, (SECONDS - 1) * 1000);
setTimeout(() => {
  console.log(proxy.hoge); // undefined
}, (SECONDS + 1) * 1000);
```

## ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã§ã€å€¤ã®åŒæœŸã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å®Ÿè£…ã§ãã¾ã™ã€‚
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ãŒå¤‰ã‚ã£ãŸæ™‚ã«ã€`input`ã®å€¤ã‚’å¤‰æ›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
åŠ ãˆã¦`input`ãŒå¤‰åŒ–ã—ãŸæ™‚ã«ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§åŒæ–¹å‘ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

```js
// <input type="text" id="inputText" /> ãŒ HTMLä¸Šã«å­˜åœ¨ã™ã‚‹ã¨ä»®å®š
const inputText = document.getElementById("inputText");

const target = {
  value: "",
};
const handler = {
  set: (target, property, value, receiver) => {
    if (property === "value") {
      inputText.value = value;
      return Reflect.set(target, property, value, receiver);
    }
    return false;
  },
};
const proxy = new Proxy(target, handler);

// proxyã®å€¤ã‚’å¤‰ãˆã‚‹ã¨ã€inputã®å€¤ãŒå¤‰ã‚ã‚‹
proxy.value = "hoge";

// inputã«å€¤ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€proxyã®å€¤ãŒå¤‰ã‚ã‚‹
inputText.addEventListener("input", e => {
  proxy.value = e.currentTarget.value;
});
```

## åˆ¥ã®å‡¦ç†ã®ãƒˆãƒªã‚¬ãƒ¼

åˆ¥ã®å‡¦ç†ã®ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
ãŸã¨ãˆã°ä½•ã‹ã—ã‚‰ã®å…¥åŠ›ãŒæˆåŠŸã—ãŸæ™‚ã«ã€ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ãªå®Ÿè£…ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

```js
const sendEmail = () => {
  // ...å‡¦ç†
  console.log("ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ");
};
const errorLog = () => {
  // ...å‡¦ç†
  console.log("å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ");
};

const target = {
  status: "",
};
const handler = {
  set: (target, property, value, receiver) => {
    if (property !== "status") {
      console.error("å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™");
      return false;
    }

    if (value === "success") {
      sendEmail();
      return Reflect.set(target, property, value, receiver);
    }

    if (value === "failure") {
      errorLog();
      return Reflect.set(target, property, value, receiver);
    }

    console.error("success ã‹ failure ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return false;
  },
};
const proxy = new Proxy(target, handler);
proxy.status = "success"; // "ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ"
```

# ã¾ã¨ã‚

ä»Šå›ã¯JavaScriptã®Proxyã«ã¤ã„ã¦ã€æ”¹ã‚ã¦å­¦ã³ç›´ã—ã¾ã—ãŸã€‚
æ­£ç›´ãªè©±ã€ã»ã¨ã‚“ã©ä½¿ã£ãŸã“ã¨ã‚‚é­é‡ã—ãŸã“ã¨ã‚‚ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ä»Šå›ã„ã‚ã„ã‚èª¿ã¹ã¦ã¿ã¦å°‘ã—ç†è§£ãŒé€²ã‚“ã ã¨æ€ã„ã¾ã™ã€‚
ä»Šå¾Œã¯é©åˆ‡ãªå ´é¢ã§ä½¿ãˆã‚‹ã¨å¬‰ã—ã„ã§ã™ã­ã€‚

# å‚è€ƒ
https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Proxy
https://uhyohyo.net/javascript/16_14.html
https://ja.javascript.info/proxy
https://note.affi-sapo-sv.com/js-proxy.php
https://blog.logrocket.com/practical-use-cases-for-javascript-es6-proxies/
https://blog.bitsrc.io/a-practical-guide-to-es6-proxy-229079c3c2f0